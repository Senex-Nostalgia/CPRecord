<h2>题目描述</h2>
<ol>
<li>计算 <img src="http://latex.codecogs.com/gif.latex?\binom%20nm\%\,p"> 的值。</li>
<li>计算 <i>m</i> 种颜色的 <i>p</i> 阶项链在考虑<b>旋转、翻转</b>的情况下有多少种本质不同的类型 (结果模 10<sup>9</sup> + 7)。</li>
</ol>

<h2>输入格式</h2>
<p>一行，包含三个正整数 <i>n</i>, <i>m</i>, <i>p</i>，含义如描述所述。</p>
<p style="color: red"><b>注：保证 <i>p</i> 的所有素因子不超过 100。</b></p>

<h2>输出格式</h2>
<p>共两行，每行一个整数，表示每个问题的答案。</p>

<h2>题解</h2>
<p><s>又是一道喜闻乐见的数学题~</s></p>
<p><s>据 scx 认为</s>，第二个问题比第一个问题<s>略简单</s>，所以先看第二个问题。</p>
<p>我们先来看一下这个问题的弱化版：<a href="https://vijos.org/d/jcsy/p/5950f847d3d8a11127af53f7" target="_blank">【模板】Pólya 计数定理</a>。</p>
<p><s>常年不考的</s> Pólya 计数定理又奇迹般地出现啦！当然<s>假装你们都会 Pólya 计数定理</s>了。</p>
<p>不妨记为 <i>m</i> 色 <i>n</i> 阶项链吧。</p>
<p>可以看出，置换群 <img src="http://latex.codecogs.com/gif.latex?\left(G,\circ\right)"> (○ 为置换的复合) 共有 2<i>n</i> 个置换。<i>n</i> 个旋转的置换 <i>f</i><sub>1</sub>, <i>f</i><sub>2</sub>, ..., <i>f<sub>n</sub></i>，以及它们对应翻转后的置换 <i>g</i><sub>1</sub>, <i>g</i><sub>2</sub>, ..., <i>g<sub>n</sub></i>。</p>
<p>由 Pólya 计数定理，可以得到 <img src="http://latex.codecogs.com/gif.latex?L=\frac1{\left|G\right|}\sum_{f\in%20G}m^{c\left(f\right)}=\frac1{2n}\left(\sum_{i=1}^nm^{\left(i,n\right)}+\frac%20n2\left(m^{\left\lfloor\frac{n+1}2\right\rfloor}+m^{\left\lceil\frac{n+1}2\right\rceil}\right)\right)">，可以看到，右边的东西快速幂可以轻松搞定，主要是左边的那个东西。</p>
<p>左边的东西怎么办？还是那句老话，看到 ∑ 就玩和式变换！</p>
<p><img src="http://latex.codecogs.com/gif.latex?\sum_{i=1}^nm^{\left(i,n\right)}=\sum_{d|n}\left(m^d\cdot\sum_{i=1}^{n/d}\left[\left(id,n\right)=d\right]\right)=\sum_{d|n}m^d\cdot\phi\left(\frac%20nd\right)"></p>
<p>由于上面红字所写的福利条件 (<i>p</i> 的素因子不超过 100)，于是可以轻松求出 <i>p</i> 的标准分解式，然后直接 dfs 枚举因数，时间复杂度 <img src="http://latex.codecogs.com/gif.latex?\Theta\left(d\left(n\right)\right)">。</p>
<p>再来看一看<s>非常鬼畜</s>的第一个问题。</p>
<p>首先，显然滴使用孙子定理将它拆分为 <img src="http://latex.codecogs.com/gif.latex?\binom%20nm\%\,p^\alpha">，其中 <i>p</i> 为素数。</p>
<p>根据公式 <img src="http://latex.codecogs.com/gif.latex?\binom%20nm=\frac{n!}{m!\left(n-m\right)!}"> 和 <img src="http://latex.codecogs.com/gif.latex?v_p\left(n!\right)=\sum_{i=1}^\infty\frac%20n{p^i}">，可以求出 <img src="http://latex.codecogs.com/gif.latex?\binom%20nm"> 中的素因子 <i>p</i> 的次数 <img src="http://latex.codecogs.com/gif.latex?v_p\binom%20nm">。</p>
<p>然后转化成了求 <i>n</i>! 中去掉所有的因子 <i>p</i> 后 (记作 <i>n</i>?) 模 <i>p<sup>α</sup></i> 的值，再用逆元就可以了。</p>
<p>注意，逆元不能用 Fermat 小定理，要用 Euler 定理或扩展 Euclid！</p>
<p>求 <img src="http://latex.codecogs.com/gif.latex?n?\,\%\,p^\alpha"> 时，可以考虑构造一个多项式 <img src="http://latex.codecogs.com/gif.latex?f\left(x\right)=\left(x+1\right)\left(x+2\right)\cdots\left(x+p-1\right)">，那么答案可以变成多项式代入一些 <i>p</i> 的倍数后的值的乘积再乘一个零头。</p>
<p>(scx: 然而要代入的值还是太多啊！)</p>
<p>所以我们需要将多项式的个数减少。可以利用倍增的思想，求出 <img src="http://latex.codecogs.com/gif.latex?P_1\left(x\right)=\left(x+1\right)\cdots\left(x+p-1\right)\left(x+p+1\right)\cdots\left(x+2p-1\right)=f\left(x\right)\cdot%20f\left(x+p\right)">，</p>
<p>进而求出 <img src="http://latex.codecogs.com/gif.latex?P_2\left(x\right)=f\left(x\right)\cdot%20f\left(x+p\right)\cdot%20f\left(x+2p\right)\cdot%20f\left(x+3p\right)=P_1\left(x\right)\cdot%20P_1\left(x+2p\right)">，<img src="http://latex.codecogs.com/gif.latex?P_3\left(x\right)=P_2\left(x\right)\cdot%20P_2\left(x+4p\right)">，……，<img src="http://latex.codecogs.com/gif.latex?P_n\left(x\right)=P_{n-1}\left(x\right)\cdot P_{n-1}\left(x+2^{n-1}p\right)">。</p>
<p>中间函数复合的过程可以用秦九韶算法完成。</p>
<p>最后将 <img src="http://latex.codecogs.com/gif.latex?\frac%20np"> 变为二进制，分别代入适当的多项式，将常数项乘起来即可。具体过程可以看代码，<s>注释已经写得很详细了</s>。</p>
<p>时间复杂度大概是 <img src="http://latex.codecogs.com/gif.latex?\Theta(\alpha^2)">。</p>

<h2>代码</h2>

<link type="text/css" rel="stylesheet" href="../additional_files/css/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/css/sh_typical.min.css">

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> MAX <span class="sh_number">1024404</span>
<span class="sh_preproc">#define</span> <span class="sh_usertype">ARR</span><span class="sh_normal"> </span>MAX <span class="sh_symbol">+</span> <span class="sh_number">1</span>
<span class="sh_preproc">#define</span> PRS <span class="sh_number">34</span>
<span class="sh_preproc">#define</span> DEG <span class="sh_number">60</span>
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">typedef</span> <span class="sh_type">long</span> <span class="sh_type">long</span> ll<span class="sh_symbol">;</span>
<span class="sh_keyword">typedef</span> <span class="sh_type">long</span> <span class="sh_type">double</span> ld<span class="sh_symbol">;</span>

<span class="sh_keyword">const</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>mod <span class="sh_symbol">=</span> <span class="sh_number">1000000007</span><span class="sh_symbol">;</span>
<span class="sh_keyword">const</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>half_mod <span class="sh_symbol">=</span> <span class="sh_number">500000004</span><span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">Poly</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> deg<span class="sh_symbol">;</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>c<span class="sh_symbol">;</span>
    <span class="sh_function">Poly</span> <span class="sh_symbol">():</span> <span class="sh_function">deg</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>c <span class="sh_symbol">=</span> NULL<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_symbol">~</span><span class="sh_function">Poly</span> <span class="sh_symbol">()</span> <span class="sh_cbracket">{</span><span class="sh_keyword">if</span><span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_keyword">delete</span> <span class="sh_symbol">[]</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">zero</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span><span class="sh_function">memset</span><span class="sh_symbol">(</span>c<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> deg <span class="sh_symbol">+</span> <span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">3</span><span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">resize</span><span class="sh_symbol">(</span><span class="sh_type">int</span> degree<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">if</span><span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_keyword">delete</span> <span class="sh_symbol">[]</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">);</span> c <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> ll<span class="sh_symbol">[(</span>deg <span class="sh_symbol">=</span> degree<span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span> <span class="sh_function">zero</span><span class="sh_symbol">();</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">copy</span><span class="sh_symbol">(</span><span class="sh_usertype">Poly</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>src<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">if</span><span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_keyword">delete</span> <span class="sh_symbol">[]</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">);</span> c <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> ll<span class="sh_symbol">[(</span>deg <span class="sh_symbol">=</span> src<span class="sh_symbol">.</span>deg<span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span> <span class="sh_function">memcpy</span><span class="sh_symbol">(</span>c<span class="sh_symbol">,</span> src<span class="sh_symbol">.</span>c<span class="sh_symbol">,</span> deg <span class="sh_symbol">+</span> <span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">3</span><span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">con</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>a0<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">resize</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">);</span> c<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> a0<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">linear</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>a0<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>a1<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">resize</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">);</span> c<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> a0<span class="sh_symbol">;</span> c<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> a1<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">debug</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span><span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"Degree: %d, Coefficients: (increasing)</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> deg<span class="sh_symbol">);</span> <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> deg<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span>
        <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%lld%c"</span><span class="sh_symbol">,</span> c<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> <span class="sh_symbol">(</span>i <span class="sh_symbol">==</span> deg <span class="sh_symbol">?</span> <span class="sh_string">'</span><span class="sh_specialchar">\n</span><span class="sh_string">'</span> <span class="sh_symbol">:</span> <span class="sh_string">' '</span><span class="sh_symbol">));</span><span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_usertype">ll</span><span class="sh_normal"> </span>n<span class="sh_symbol">,</span> m<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> ans<span class="sh_symbol">,</span> Mod<span class="sh_symbol">;</span>
<span class="sh_usertype">ll</span><span class="sh_normal"> </span>pi<span class="sh_symbol">[</span>PRS<span class="sh_symbol">],</span> deg<span class="sh_symbol">[</span>PRS<span class="sh_symbol">],</span> cans<span class="sh_symbol">[</span>PRS<span class="sh_symbol">],</span> modu<span class="sh_symbol">[</span>PRS<span class="sh_symbol">];</span>
<span class="sh_usertype">Poly</span><span class="sh_normal"> </span>poly<span class="sh_symbol">[</span>DEG<span class="sh_symbol">];</span>
<span class="sh_type">int</span> cnt<span class="sh_symbol">;</span>
<span class="sh_type">int</span> pn<span class="sh_symbol">,</span> c<span class="sh_symbol">[</span>ARR<span class="sh_symbol">],</span> p<span class="sh_symbol">[</span>ARR<span class="sh_symbol">];</span>

<span class="sh_keyword">inline</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_function">MulMod</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>a<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>b<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>m<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_usertype">ll</span><span class="sh_normal"> </span>t <span class="sh_symbol">=</span> a <span class="sh_symbol">*</span> b <span class="sh_symbol">-</span> <span class="sh_symbol">(</span>ll<span class="sh_symbol">)((</span>ld<span class="sh_symbol">)</span>a <span class="sh_symbol">*</span> b <span class="sh_symbol">/</span> m <span class="sh_symbol">+</span> <span class="sh_number">1e-10</span><span class="sh_symbol">)</span> <span class="sh_symbol">*</span> m<span class="sh_symbol">;</span>
    <span class="sh_keyword">return</span> <span class="sh_symbol">(</span>t <span class="sh_symbol">%=</span> m<span class="sh_symbol">)</span> <span class="sh_symbol">&lt;</span> <span class="sh_number">0</span> <span class="sh_symbol">?</span> t <span class="sh_symbol">+</span> m <span class="sh_symbol">:</span> t<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_function">PowerMod</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>a<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>n<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>m<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>n <span class="sh_symbol">||</span> a <span class="sh_symbol">==</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_keyword">return</span> 1ll<span class="sh_symbol">;</span>
    <span class="sh_usertype">ll</span><span class="sh_normal"> </span>s <span class="sh_symbol">=</span> <span class="sh_function">PowerMod</span><span class="sh_symbol">(</span>a<span class="sh_symbol">,</span> n <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> m<span class="sh_symbol">);</span>
    s <span class="sh_symbol">=</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span>s<span class="sh_symbol">,</span> s<span class="sh_symbol">,</span> m<span class="sh_symbol">);</span>
    <span class="sh_keyword">return</span> n <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span> <span class="sh_symbol">?</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span>s<span class="sh_symbol">,</span> a<span class="sh_symbol">,</span> m<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> s<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_function">gcdex</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>a<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>b<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>y<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>b<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>x <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> y <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_keyword">return</span> a<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_usertype">ll</span><span class="sh_normal"> </span>d <span class="sh_symbol">=</span> <span class="sh_function">gcdex</span><span class="sh_symbol">(</span>b<span class="sh_symbol">,</span> a <span class="sh_symbol">%</span> b<span class="sh_symbol">,</span> y<span class="sh_symbol">,</span> x<span class="sh_symbol">);</span> y <span class="sh_symbol">-=</span> a <span class="sh_symbol">/</span> b <span class="sh_symbol">*</span> x<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> d<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">sieve</span><span class="sh_symbol">(</span><span class="sh_type">int</span> n<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">,</span> v<span class="sh_symbol">;</span>
    <span class="sh_function">memset</span><span class="sh_symbol">(</span>c<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> c<span class="sh_symbol">);</span>
    pn <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">2</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>c<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>c<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> pn<span class="sh_symbol">;</span> p<span class="sh_symbol">[</span>pn<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> j <span class="sh_symbol">&lt;</span> pn<span class="sh_symbol">;</span> j<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">((</span>v <span class="sh_symbol">=</span> i <span class="sh_symbol">*</span> p<span class="sh_symbol">[</span>j<span class="sh_symbol">])</span> <span class="sh_symbol">&gt;</span> n<span class="sh_symbol">)</span> <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
            c<span class="sh_symbol">[</span>v<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> j<span class="sh_symbol">;</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(!(</span>i <span class="sh_symbol">%</span> p<span class="sh_symbol">[</span>j<span class="sh_symbol">]))</span> <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">Factor</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>n<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">bool</span> flag <span class="sh_symbol">=</span> <span class="sh_keyword">true</span><span class="sh_symbol">;</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>cnt <span class="sh_symbol">=</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> n <span class="sh_symbol">&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_symbol">)</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>n <span class="sh_symbol">&gt;</span> MAX<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>flag <span class="sh_symbol">=</span> <span class="sh_keyword">true</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> pn <span class="sh_symbol">&amp;&amp;</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">*</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(!(</span>n <span class="sh_symbol">%</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">]))</span><span class="sh_cbracket">{</span>
                    pi<span class="sh_symbol">[++</span>cnt<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">];</span>
                    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>deg<span class="sh_symbol">[</span>cnt<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_symbol">!(</span>n <span class="sh_symbol">%</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span> n <span class="sh_symbol">/=</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> <span class="sh_symbol">++</span>deg<span class="sh_symbol">[</span>cnt<span class="sh_symbol">]);</span>
                    flag <span class="sh_symbol">=</span> <span class="sh_keyword">false</span><span class="sh_symbol">;</span> <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
                <span class="sh_cbracket">}</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>flag<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>pi<span class="sh_symbol">[++</span>cnt<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> n<span class="sh_symbol">;</span> deg<span class="sh_symbol">[</span>cnt<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
            i <span class="sh_symbol">=</span> c<span class="sh_symbol">[</span>n<span class="sh_symbol">];</span>
            pi<span class="sh_symbol">[++</span>cnt<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">];</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(</span>deg<span class="sh_symbol">[</span>cnt<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_symbol">!(</span>n <span class="sh_symbol">%</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span> n <span class="sh_symbol">/=</span> p<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> <span class="sh_symbol">++</span>deg<span class="sh_symbol">[</span>cnt<span class="sh_symbol">]);</span>
        <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">PolyMul</span><span class="sh_symbol">(</span><span class="sh_usertype">Poly</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>A<span class="sh_symbol">,</span> <span class="sh_usertype">Poly</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>B<span class="sh_symbol">,</span> <span class="sh_usertype">Poly</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>res<span class="sh_symbol">,</span> <span class="sh_type">int</span> degMax <span class="sh_symbol">=</span> INT_MAX<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>m <span class="sh_symbol">=</span> LLONG_MAX<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">;</span>
    <span class="sh_usertype">Poly</span><span class="sh_normal"> </span>C<span class="sh_symbol">;</span>
    C<span class="sh_symbol">.</span><span class="sh_function">resize</span><span class="sh_symbol">(</span><span class="sh_function">min</span><span class="sh_symbol">(</span>A<span class="sh_symbol">.</span>deg <span class="sh_symbol">+</span> B<span class="sh_symbol">.</span>deg<span class="sh_symbol">,</span> degMax<span class="sh_symbol">));</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> A<span class="sh_symbol">.</span>deg<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> j <span class="sh_symbol">&lt;=</span> B<span class="sh_symbol">.</span>deg <span class="sh_symbol">&amp;&amp;</span> i <span class="sh_symbol">+</span> j <span class="sh_symbol">&lt;=</span> degMax<span class="sh_symbol">;</span> j<span class="sh_symbol">++)</span>
            <span class="sh_symbol">(</span>C<span class="sh_symbol">.</span>c<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> j<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span>A<span class="sh_symbol">.</span>c<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> B<span class="sh_symbol">.</span>c<span class="sh_symbol">[</span>j<span class="sh_symbol">],</span> m<span class="sh_symbol">))</span> <span class="sh_symbol">&gt;=</span> m <span class="sh_symbol">?</span> C<span class="sh_symbol">.</span>c<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> j<span class="sh_symbol">]</span> <span class="sh_symbol">-=</span> m <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    res<span class="sh_symbol">.</span><span class="sh_function">copy</span><span class="sh_symbol">(</span>C<span class="sh_symbol">);</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_function">FactDeg</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>n<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>p<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> n <span class="sh_symbol">&gt;=</span> p <span class="sh_symbol">?</span> n <span class="sh_symbol">/</span> p <span class="sh_symbol">+</span> <span class="sh_function">FactDeg</span><span class="sh_symbol">(</span>n <span class="sh_symbol">/</span> p<span class="sh_symbol">,</span> p<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">Iterate</span><span class="sh_symbol">(</span><span class="sh_usertype">Poly</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>A<span class="sh_symbol">,</span> <span class="sh_usertype">Poly</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>B<span class="sh_symbol">,</span> <span class="sh_usertype">Poly</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>res<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    res<span class="sh_symbol">.</span><span class="sh_function">con</span><span class="sh_symbol">(</span>A<span class="sh_symbol">.</span>c<span class="sh_symbol">[</span>A<span class="sh_symbol">.</span>deg<span class="sh_symbol">]);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> j <span class="sh_symbol">=</span> A<span class="sh_symbol">.</span>deg <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> j <span class="sh_symbol">&gt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_symbol">--</span>j<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">PolyMul</span><span class="sh_symbol">(</span>res<span class="sh_symbol">,</span> B<span class="sh_symbol">,</span> res<span class="sh_symbol">,</span> INT_MAX<span class="sh_symbol">,</span> Mod<span class="sh_symbol">);</span>
        <span class="sh_symbol">(</span>res<span class="sh_symbol">.</span>c<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> A<span class="sh_symbol">.</span>c<span class="sh_symbol">[</span>j<span class="sh_symbol">])</span> <span class="sh_symbol">&gt;=</span> Mod <span class="sh_symbol">?</span> res<span class="sh_symbol">.</span>c<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">-=</span> Mod <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">Initialize</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>p<span class="sh_symbol">,</span> <span class="sh_type">int</span> degMax<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_usertype">Poly</span><span class="sh_normal"> </span>f<span class="sh_symbol">,</span> g<span class="sh_symbol">;</span>
    <span class="sh_usertype">ll</span><span class="sh_normal"> </span>I<span class="sh_symbol">;</span> <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
    poly<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">].</span><span class="sh_function">con</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>I <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> I <span class="sh_symbol">&lt;</span> p<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>I<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        f<span class="sh_symbol">.</span><span class="sh_function">linear</span><span class="sh_symbol">(</span>I<span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
        <span class="sh_function">PolyMul</span><span class="sh_symbol">(</span>poly<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> f<span class="sh_symbol">,</span> poly<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> degMax<span class="sh_symbol">,</span> Mod<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_comment">/*</span>
<span class="sh_comment">    P0(x) = (x + 1)(x + 2) ... (x + p - 1)</span>
<span class="sh_comment">    P1(x) = P0(x) * P0(x + p)</span>
<span class="sh_comment">    P2(x) = P0(x) * P0(x + p) * P0(x + 2p) * P0(x + 3p) = P1(x) * P1(x + 2p)</span>
<span class="sh_comment">    ...</span>
<span class="sh_comment">    Pn(x) = P0(x) * P0(x + p) * ... * P0(x + (2^n-1)p) = P_{n-1}(x) * P_{n-1}(x + 2^(n-1)p)</span>
<span class="sh_comment">    */</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> DEG<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        f<span class="sh_symbol">.</span><span class="sh_function">linear</span><span class="sh_symbol">(</span><span class="sh_function">MulMod</span><span class="sh_symbol">(</span>1ll <span class="sh_symbol">&lt;&lt;</span> i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> p<span class="sh_symbol">,</span> Mod<span class="sh_symbol">),</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
        <span class="sh_usertype">Poly</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>la <span class="sh_symbol">=</span> poly<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
        <span class="sh_function">Iterate</span><span class="sh_symbol">(</span>la<span class="sh_symbol">,</span> f<span class="sh_symbol">,</span> g<span class="sh_symbol">);</span>
        <span class="sh_function">PolyMul</span><span class="sh_symbol">(</span>la<span class="sh_symbol">,</span> g<span class="sh_symbol">,</span> poly<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> degMax<span class="sh_symbol">,</span> Mod<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_function">fem</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>n<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>p<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_comment">/*</span>
<span class="sh_comment">    calculate 1 * 2 * ... * (p - 1) * (p + 1) * ... * n,</span>
<span class="sh_comment">    which is the constant term of polynomial g(x) = P0(x) * P0(x + p) * ... * P0(x + (cycle - 1) * p),</span>
<span class="sh_comment">    and the product of it and remaining.</span>
<span class="sh_comment">    let cycle = (b_n b_{n-1} ... b_2 b_1 b_0) in base 2,</span>
<span class="sh_comment">    then g(x) = P0(b_n ... b_1) * b_0 + P1(b_n ... b_2) * b_1 + ...</span>
<span class="sh_comment">    */</span>
    <span class="sh_usertype">Poly</span><span class="sh_normal"> </span>f<span class="sh_symbol">,</span> g<span class="sh_symbol">;</span>
    <span class="sh_usertype">ll</span><span class="sh_normal"> </span>cycle <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>n <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">/</span> p<span class="sh_symbol">,</span> result <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> I <span class="sh_symbol">=</span> cycle <span class="sh_symbol">*</span> p <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_number">1</span> <span class="sh_symbol">&lt;&lt;</span> i <span class="sh_symbol">&lt;=</span> cycle<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>cycle <span class="sh_symbol">&gt;&gt;</span> i <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            cycle <span class="sh_symbol">&amp;=</span> cycle <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
            f<span class="sh_symbol">.</span><span class="sh_function">linear</span><span class="sh_symbol">(</span><span class="sh_function">MulMod</span><span class="sh_symbol">(</span>cycle<span class="sh_symbol">,</span> p<span class="sh_symbol">,</span> Mod<span class="sh_symbol">),</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
            <span class="sh_function">Iterate</span><span class="sh_symbol">(</span>poly<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> f<span class="sh_symbol">,</span> g<span class="sh_symbol">);</span>
            result <span class="sh_symbol">=</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span>result<span class="sh_symbol">,</span> g<span class="sh_symbol">.</span>c<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> Mod<span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> I <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>I<span class="sh_symbol">)</span> result <span class="sh_symbol">=</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span>result<span class="sh_symbol">,</span> I<span class="sh_symbol">,</span> Mod<span class="sh_symbol">);</span>
    <span class="sh_keyword">return</span> result<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">ll</span><span class="sh_normal"> </span><span class="sh_function">FactMod</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>n<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>p<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> n <span class="sh_symbol">&gt;=</span> p <span class="sh_symbol">?</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span><span class="sh_function">fem</span><span class="sh_symbol">(</span>n<span class="sh_symbol">,</span> p<span class="sh_symbol">),</span> <span class="sh_function">FactMod</span><span class="sh_symbol">(</span>n <span class="sh_symbol">/</span> p<span class="sh_symbol">,</span> p<span class="sh_symbol">),</span> Mod<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">fem</span><span class="sh_symbol">(</span>n<span class="sh_symbol">,</span> p<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">Work1</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
    <span class="sh_usertype">ll</span><span class="sh_normal"> </span>p<span class="sh_symbol">,</span> D<span class="sh_symbol">,</span> s1<span class="sh_symbol">,</span> s2<span class="sh_symbol">,</span> s3<span class="sh_symbol">,</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> cnt<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        Mod <span class="sh_symbol">=</span> modu<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">PowerMod</span><span class="sh_symbol">(</span>p <span class="sh_symbol">=</span> pi<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> deg<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> LLONG_MAX<span class="sh_symbol">);</span>
        D <span class="sh_symbol">=</span> <span class="sh_function">FactDeg</span><span class="sh_symbol">(</span>n<span class="sh_symbol">,</span> p<span class="sh_symbol">)</span> <span class="sh_symbol">-</span> <span class="sh_function">FactDeg</span><span class="sh_symbol">(</span>m<span class="sh_symbol">,</span> p<span class="sh_symbol">)</span> <span class="sh_symbol">-</span> <span class="sh_function">FactDeg</span><span class="sh_symbol">(</span>n <span class="sh_symbol">-</span> m<span class="sh_symbol">,</span> p<span class="sh_symbol">);</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>D <span class="sh_symbol">&gt;=</span> deg<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>cans<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_keyword">continue</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_function">Initialize</span><span class="sh_symbol">(</span>p<span class="sh_symbol">,</span> deg<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
        s1 <span class="sh_symbol">=</span> <span class="sh_function">FactMod</span><span class="sh_symbol">(</span>n<span class="sh_symbol">,</span> p<span class="sh_symbol">);</span>
        s2 <span class="sh_symbol">=</span> <span class="sh_function">FactMod</span><span class="sh_symbol">(</span>m<span class="sh_symbol">,</span> p<span class="sh_symbol">);</span>
        s3 <span class="sh_symbol">=</span> <span class="sh_function">FactMod</span><span class="sh_symbol">(</span>n <span class="sh_symbol">-</span> m<span class="sh_symbol">,</span> p<span class="sh_symbol">);</span>
        <span class="sh_function">gcdex</span><span class="sh_symbol">(</span>s2<span class="sh_symbol">,</span> Mod<span class="sh_symbol">,</span> s2<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
        <span class="sh_function">gcdex</span><span class="sh_symbol">(</span>s3<span class="sh_symbol">,</span> Mod<span class="sh_symbol">,</span> s3<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
        s1 <span class="sh_symbol">=</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span>s1<span class="sh_symbol">,</span> s2<span class="sh_symbol">,</span> Mod<span class="sh_symbol">);</span>
        s1 <span class="sh_symbol">=</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span>s1<span class="sh_symbol">,</span> s3<span class="sh_symbol">,</span> Mod<span class="sh_symbol">);</span>
        cans<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span>s1<span class="sh_symbol">,</span> <span class="sh_function">PowerMod</span><span class="sh_symbol">(</span>p<span class="sh_symbol">,</span> D<span class="sh_symbol">,</span> Mod<span class="sh_symbol">),</span> Mod<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> cnt <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">gcdex</span><span class="sh_symbol">(</span>modu<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> modu<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">],</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
        cans<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> v <span class="sh_symbol">*</span> <span class="sh_symbol">(</span>cans<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> cans<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">])</span> <span class="sh_symbol">%</span> modu<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">*</span> modu<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">+</span> cans<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
        modu<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">*=</span> modu<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
        <span class="sh_symbol">(</span>cans<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">%=</span> modu<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span> <span class="sh_symbol">&lt;</span> <span class="sh_number">0</span> <span class="sh_symbol">?</span> cans<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> modu<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%lld</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> cans<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]);</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">dfs</span><span class="sh_symbol">(</span><span class="sh_type">int</span> dep<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>r<span class="sh_symbol">,</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>phi<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
    <span class="sh_usertype">ll</span><span class="sh_normal"> </span>S<span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>dep <span class="sh_symbol">&gt;</span> cnt<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        S <span class="sh_symbol">=</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span><span class="sh_function">PowerMod</span><span class="sh_symbol">(</span>m <span class="sh_symbol">%</span> mod<span class="sh_symbol">,</span> r<span class="sh_symbol">,</span> mod<span class="sh_symbol">),</span> phi <span class="sh_symbol">%</span> mod<span class="sh_symbol">,</span> mod<span class="sh_symbol">);</span>
        <span class="sh_symbol">(</span>ans <span class="sh_symbol">+=</span> S<span class="sh_symbol">)</span> <span class="sh_symbol">&gt;=</span> mod <span class="sh_symbol">?</span> ans <span class="sh_symbol">-=</span> mod <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
        S <span class="sh_symbol">=</span> <span class="sh_function">PowerMod</span><span class="sh_symbol">(</span>pi<span class="sh_symbol">[</span>dep<span class="sh_symbol">],</span> deg<span class="sh_symbol">[</span>dep<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> LLONG_MAX<span class="sh_symbol">)</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span>pi<span class="sh_symbol">[</span>dep<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> deg<span class="sh_symbol">[</span>dep<span class="sh_symbol">];</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_function">dfs</span><span class="sh_symbol">(</span>dep <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> r<span class="sh_symbol">,</span> phi <span class="sh_symbol">*</span> S<span class="sh_symbol">);</span>
            r <span class="sh_symbol">*=</span> pi<span class="sh_symbol">[</span>dep<span class="sh_symbol">];</span> <span class="sh_symbol">++</span>S <span class="sh_symbol">/=</span> pi<span class="sh_symbol">[</span>dep<span class="sh_symbol">];</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">Work2</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    ans <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_function">dfs</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
    ans <span class="sh_symbol">=</span> <span class="sh_function">MulMod</span><span class="sh_symbol">(</span>ans<span class="sh_symbol">,</span> <span class="sh_function">PowerMod</span><span class="sh_symbol">(</span>l <span class="sh_symbol">%</span> mod<span class="sh_symbol">,</span> mod <span class="sh_symbol">-</span> <span class="sh_number">2</span><span class="sh_symbol">,</span> mod<span class="sh_symbol">),</span> mod<span class="sh_symbol">);</span>
    <span class="sh_symbol">(</span>ans <span class="sh_symbol">&lt;&lt;=</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">%=</span> mod<span class="sh_symbol">;</span>
    <span class="sh_symbol">(</span>ans <span class="sh_symbol">+=</span> <span class="sh_function">PowerMod</span><span class="sh_symbol">(</span>m <span class="sh_symbol">%</span> mod<span class="sh_symbol">,</span> l <span class="sh_symbol">+</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> mod<span class="sh_symbol">))</span> <span class="sh_symbol">&gt;=</span> mod <span class="sh_symbol">?</span> ans <span class="sh_symbol">-=</span> mod <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_symbol">(</span>ans <span class="sh_symbol">+=</span> <span class="sh_function">PowerMod</span><span class="sh_symbol">(</span>m <span class="sh_symbol">%</span> mod<span class="sh_symbol">,</span> l <span class="sh_symbol">+</span> <span class="sh_number">2</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> mod<span class="sh_symbol">))</span> <span class="sh_symbol">&gt;=</span> mod <span class="sh_symbol">?</span> ans <span class="sh_symbol">-=</span> mod <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    ans <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>ans <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_symbol">(</span>ans <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span> <span class="sh_symbol">?</span> half_mod <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
    ans <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>ans <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_symbol">(</span>ans <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span> <span class="sh_symbol">?</span> half_mod <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
    <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%lld</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> ans<span class="sh_symbol">);</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">sieve</span><span class="sh_symbol">(</span>MAX<span class="sh_symbol">);</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%lld%lld%lld"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>m<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>l<span class="sh_symbol">);</span>
    <span class="sh_function">Factor</span><span class="sh_symbol">(</span>l<span class="sh_symbol">);</span>
    <span class="sh_function">Work1</span><span class="sh_symbol">();</span>
    <span class="sh_function">Work2</span><span class="sh_symbol">();</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

</code></pre></div>

<h2>坑</h2>
<p>又是一道代码量超大的题目……果然又花了好长时间……</p>
<p>不过先提醒一下，这里的乘模运算可能爆 long long，所以可以用黑科技浮点模，两边自然溢出后去减 (具体见代码或主页的模板)</p>
<p><b>坑1：</b>第一个问题中，对合数求逆元千万不要天真地 <code>PowerMod(a, m - 2, m)</code>，可以用扩展 Euclid，当然由于这道题是素数的幂，可以容易地求出 <i>φ</i> (Euler 函数) 值，所以用 Euler 定理也是可以滴。</p>
<p><b>坑2：</b>孙子定理的公式要熟练，还有一些小优化不要漏掉 (比较黑的题目可能会来卡你)。</p>
<p><s><b>坑3：</b>由于这道题一个样例和两个数据是错的 (导致标程都不能过样例)，所以浪费了挺多的时间……</s></p>
<p>还有，奇数模意义下除以 2 有一个很奇怪的姿势，具体见代码。</p>
