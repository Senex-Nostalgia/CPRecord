<link type="text/css" rel="stylesheet" href="../additional_files/css/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/css/sh_typical.min.css">
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$', '$']], displayMath: [['$$', '$$']]}});</script>
<script type="text/javascript" src="../additional_files/MathJax-master/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<h3>题目描述</h3>
<p><img src="http://www.lydsy.com/JudgeOnline/images/1093/1.jpg" alt="最大半连通子图" /></p>

<h3>输入格式</h3>
<p>第一行包含三个正整数 $n, m, x$ ($n \leq 10^5, m \leq 10^6, x \leq 10^8$)，$n, m$ 分别表示图 $G$ 的点数与边数，$X$ 的意义如上文所述。</p>
<p>接下来 $m$ 行，每行两个正整数 $a, b$，表示一条有向边 $(a, b)$。图中的每个点将编号为 $1, 2, 3, \cdots, n$，保证输入中同一个 $(a, b)$ 不会出现两次。</p>

<h3>输出格式</h3>
<p>输出两行，第一行包含一个整数 $K$。第二行包含整数 $C \bmod X$。</p>

<h3>题解</h3>
<p>"半连通" 的意思即两点 $u, v$ 要么 $u \to v$ 有通路，要么 $v \to u$ 有通路。那么如果 $u, v$ 是强连通的，则它们一定是半连通的。</p>
<p>那么对于某一个强连通分量，如果其中有一个点在某个半连通子图内，则这个强连通分量中的<strong>所有点</strong>都可以加入并且依然满足 "半连通" 的性质。</p>
<p>于是原图中，每个强连通分量作为一个整体，因此可以进行 (Tarjan) 缩点。考虑一个有向无环图，它的半连通子图中，任意两个点肯定是按照<strong>拓扑序</strong>连通。</p>
<p>于是就可以 DP 了，记 $f_i$ 表示到 (缩点后) 点 $i$ 为止的 (带权) 最大半连通子图的大小。则对于点 $i$，设连接到点 $i$ 的点的集合为 $N^+(i)$，点 $i$ 的权值 (对应的强连通分量的大小) 为 $w_i$，则 $$ f_i = \left( \max_{k \in N^+(i)} f_k \right) + w_i $$</p>
<p>最后所有 $f_i$ 的最大值即为所求 (注意图可能是不连通的)。接下来是最大半连通子图的个数，可以参考<a href="../index.html?redirect=147" target="_blank">这道题</a>。即令 $g_i$ 表示到点 $i$ 为止的大小为 $f_i$ 的半连通子图的个数，则对 $f_k + w_i &gt; f_i$ 的 $k$，令 $g_i \gets g_k$；对 $f_k + w_i = f_i$ 的 $k$，只需要 $g_i \gets g_i + g_k$。</p>
<p>最后只需把满足 $f_k = \max f_i$ 的 $k$ 所对应的 $g_k$ 相加就是答案，时间复杂度 $O(n + m)$。</p>

<h3>代码</h3>

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> N <span class="sh_number">100034</span>
<span class="sh_preproc">#define</span> M <span class="sh_number">1024404</span>
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">edge</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">;</span>
    <span class="sh_function">edge</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> u0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> v0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">):</span> <span class="sh_function">u</span><span class="sh_symbol">(</span>u0<span class="sh_symbol">),</span> <span class="sh_function">v</span><span class="sh_symbol">(</span>v0<span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
<span class="sh_cbracket">}</span>e<span class="sh_symbol">[</span>M<span class="sh_symbol">];</span>

<span class="sh_type">int</span> mod<span class="sh_symbol">;</span>
<span class="sh_type">int</span> V<span class="sh_symbol">,</span> E<span class="sh_symbol">,</span> Es<span class="sh_symbol">;</span>
<span class="sh_type">int</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> i<span class="sh_symbol">;</span>
<span class="sh_type">int</span> first<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> next<span class="sh_symbol">[</span>M<span class="sh_symbol">];</span> <span class="sh_comment">// adj</span>
<span class="sh_type">int</span> cnt <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> id<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> low<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span> <span class="sh_comment">// tarjan</span>
<span class="sh_type">int</span> stc <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> sta<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> in_stack<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span> <span class="sh_comment">// stack</span>
<span class="sh_type">int</span> scc <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> bel<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> top<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span> <span class="sh_comment">// shrink</span>
<span class="sh_type">int</span> deg<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> size<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> que<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span> <span class="sh_comment">// toposort</span>
<span class="sh_type">int</span> f<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> g<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> hash<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span> <span class="sh_comment">// dp</span>
<span class="sh_type">int</span> ans<span class="sh_symbol">,</span> Count<span class="sh_symbol">;</span>

<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">up</span><span class="sh_symbol">(</span><span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> y<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>x <span class="sh_symbol">&lt;</span> y <span class="sh_symbol">?</span> x <span class="sh_symbol">=</span> y <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">down</span><span class="sh_symbol">(</span><span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> y<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>x <span class="sh_symbol">&gt;</span> y <span class="sh_symbol">?</span> x <span class="sh_symbol">=</span> y <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">add</span><span class="sh_symbol">(</span><span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> y<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_symbol">(</span>x <span class="sh_symbol">+=</span> y<span class="sh_symbol">)</span> <span class="sh_symbol">&gt;=</span> mod <span class="sh_symbol">?</span> x <span class="sh_symbol">-=</span> mod <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span><span class="sh_type">int</span> u<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>e<span class="sh_symbol">[++</span>Es<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">edge</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span> next<span class="sh_symbol">[</span>Es<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">];</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> Es<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">tarjan</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> y<span class="sh_symbol">;</span>
    id<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> low<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">++</span>cnt<span class="sh_symbol">;</span> in_stack<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> sta<span class="sh_symbol">[</span>stc<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> x<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>id<span class="sh_symbol">[</span>y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
            <span class="sh_function">tarjan</span><span class="sh_symbol">(</span>y<span class="sh_symbol">);</span> <span class="sh_function">down</span><span class="sh_symbol">(</span>low<span class="sh_symbol">[</span>x<span class="sh_symbol">],</span> low<span class="sh_symbol">[</span>y<span class="sh_symbol">]);</span>
        <span class="sh_cbracket">}</span><span class="sh_keyword">else</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>in_stack<span class="sh_symbol">[</span>y<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
            <span class="sh_function">down</span><span class="sh_symbol">(</span>low<span class="sh_symbol">[</span>x<span class="sh_symbol">],</span> id<span class="sh_symbol">[</span>y<span class="sh_symbol">]);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>id<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> low<span class="sh_symbol">[</span>x<span class="sh_symbol">])</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>top<span class="sh_symbol">[++</span>scc<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> x<span class="sh_symbol">,</span> y <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> y <span class="sh_symbol">!=</span> x<span class="sh_symbol">;</span> <span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            y <span class="sh_symbol">=</span> sta<span class="sh_symbol">[--</span>stc<span class="sh_symbol">];</span> in_stack<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> bel<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> scc<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>size<span class="sh_symbol">[</span>scc<span class="sh_symbol">];</span>
        <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">topo_sort_dp</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> h<span class="sh_symbol">,</span> t <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> x<span class="sh_symbol">,</span> y<span class="sh_symbol">,</span> i<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> scc<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>deg<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span> <span class="sh_cbracket">{</span>que<span class="sh_symbol">[</span>t<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span> f<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> size<span class="sh_symbol">[</span>i<span class="sh_symbol">];</span> g<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>h <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> h <span class="sh_symbol">&lt;</span> t<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>h<span class="sh_symbol">)</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>x <span class="sh_symbol">=</span> que<span class="sh_symbol">[</span>h<span class="sh_symbol">]];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(!--</span>deg<span class="sh_symbol">[</span>y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">])</span> que<span class="sh_symbol">[</span>t<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> y<span class="sh_symbol">;</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>hash<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">!=</span> x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
                hash<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> x<span class="sh_symbol">;</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> size<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;</span> f<span class="sh_symbol">[</span>y<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
                    f<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> f<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> size<span class="sh_symbol">[</span>y<span class="sh_symbol">];</span> g<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> g<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span>
                <span class="sh_cbracket">}</span><span class="sh_keyword">else</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> size<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> f<span class="sh_symbol">[</span>y<span class="sh_symbol">])</span>
                    <span class="sh_function">add</span><span class="sh_symbol">(</span>g<span class="sh_symbol">[</span>y<span class="sh_symbol">],</span> g<span class="sh_symbol">[</span>x<span class="sh_symbol">]);</span>
            <span class="sh_cbracket">}</span>
        <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>V<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>E<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>mod<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> E<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>u<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>v<span class="sh_symbol">);</span>
        <span class="sh_function">addedge</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> V<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>id<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span> <span class="sh_function">tarjan</span><span class="sh_symbol">(</span>i<span class="sh_symbol">);</span>
    Es <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_function">memset</span><span class="sh_symbol">(</span>first<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> first<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> E<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">((</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>u <span class="sh_symbol">=</span> bel<span class="sh_symbol">[</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>u<span class="sh_symbol">])</span> <span class="sh_symbol">!=</span> <span class="sh_symbol">(</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v <span class="sh_symbol">=</span> bel<span class="sh_symbol">[</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">]))</span><span class="sh_cbracket">{</span>
            <span class="sh_function">addedge</span><span class="sh_symbol">(</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>u<span class="sh_symbol">,</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">);</span>
            <span class="sh_symbol">++</span>deg<span class="sh_symbol">[</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">];</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_function">topo_sort_dp</span><span class="sh_symbol">();</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> scc<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> <span class="sh_function">up</span><span class="sh_symbol">(</span>ans<span class="sh_symbol">,</span> f<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> scc<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>f<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> ans<span class="sh_symbol">)</span> <span class="sh_function">add</span><span class="sh_symbol">(</span>Count<span class="sh_symbol">,</span> g<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
    <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%d</span><span class="sh_specialchar">\n</span><span class="sh_string">%d</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> ans<span class="sh_symbol">,</span> Count<span class="sh_symbol">);</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

</code></pre></div>

<h3>坑</h3>
<p><strong>坑1：</strong>这题汇聚了多个模板 (Tarjan; 缩点; 拓扑排序)，因此各个模板需要背熟练。</p>
<p><strong>坑2：</strong>注意缩点后的图可能有<strong>重边</strong>，因此在 DP 的时候注意去重，避免一个 $g_k$ 更新多次。</p>

