<h2>题目描述</h2>
<p>scx 非常喜欢和等差数列玩耍。</p>
<p>有一天，她给了你一个长度为 <i>n</i> 的序列，其中第 <i>i</i> 个数为 <i>a<sub>i</sub></i>。</p>
<p>她想考考你，每次她会给出询问 <i>l</i>, <i>r</i>, <i>k</i>，问区间 [<i>l</i>, <i>r</i>]内的数从小到大排序后能否形成公差为k的等差数列。</p>
<p>当然，她还会不断修改其中的某一项。</p>
<p>为了<s>被她看上</s>，你必须要快速并正确地回答完所有问题。</p>
<p>注意：只有一个数的数列也是等差数列。</p>

<h2>输入格式</h2>
<p>第一行包含两个正整数 n, m(1 ≤ n, m ≤ 3×10<sup>5</sup>)，分别表示序列的长度和操作的次数。</p>
<p>第二行包含 n 个整数，依次表示序列中的每个数 a[i](0 ≤ a[i] ≤ 10<sup>9</sup>)。</p>
<p>接下来 m 行，每行一开始为一个数 op，</p>
<p>若 op == 1，则接下来两个整数 x, y(1 ≤ x ≤ n，0 ≤ y ≤ 10<sup>9</sup>)，表示把 a[x] 修改为 y。</p>
<p>若 op == 2，则接下来三个整数 l, r, k(1 ≤ l ≤ r ≤ n，0 ≤ k ≤ 10<sup>9</sup>)，表示一个询问。</p>
<p>在本题中，x, y, l, r, k都是经过加密的，都需要异或你之前输出的Yes的个数来进行解密。</p>

<h2>输出格式</h2>
<p>输出若干行，对于每个询问，如果可以形成等差数列，那么输出<code>Yes</code>，否则输出<code>No</code>。</p>

<h2>题解</h2>
<p>又是一道坑题……话说这道题看起来思路其实不难，实现还是比较坑的。(scx: 感觉不是非常坑的样子)</p>
<p>不过话说回来，这道题还是一道<s>比较裸的</s>线段树的题目。</p>
<p>不过我怎么觉得这道题的提交记录也是非常玄学的……(一般人都交了好几次，还有你为什么 AC 代码交了那么多次，所以本期题解新增栏目“<a href="#cancer">毒瘤(<font color="red">cancer</font>)</a>”。</p>
<p>废话不多说，直接上正题。</p>
<p>首先，<i>n</i> 个数 <i>a</i><sub>1</sub>, <i>a</i><sub>2</sub>, ..., <i>a<sub>n</sub></i>, 排序后成公差为 <i>d</i> 的等差数列的充要条件是：</p>
<p>max{<i>a</i><sub>1</sub>, <i>a</i><sub>2</sub>, ..., <i>a<sub>n</sub></i>} - min{<i>a</i><sub>1</sub>, <i>a</i><sub>2</sub>, ..., <i>a<sub>n</sub></i>} = <i>d</i>·(<i>n</i> - 1) 且 gcd(<i>a</i><sub>2</sub> - <i>a</i><sub>1</sub>, <i>a</i><sub>3</sub> - <i>a</i><sub>2</sub>, ..., <i>a<sub>n</sub></i> - <i>a</i><sub><i>n</i> - 1</sub>) = <i>d</i> 且 <i>a</i><sub>1</sub>, <i>a</i><sub>2</sub>, ..., <i>a<sub>n</sub></i> 两两不重复。</p>
<p>可以看到，区间 max、区间 min、一阶差分的区间 gcd 都是可以用线段树轻松维护的，难点就是判断两两不重复。</p>
<p>(scx: 判断两两不重复能不能 hash 这个等差数列再比较？)</p>
<p>我这里先讲一个结论，不 TLE 的 hash 都是可以被卡掉的。建议你看一下这个分析的过程，如果知道或不想看分析直接想看正解的<a href="#std">点击此处</a>。</p>
<p>现在假装这道题可以用 hash 算法，首先，由于询问的是排序后能否形成等差数列，所以这个 hash 算法必须是无序的(比如<code>1 4 7 10</code>和<code>4 10 7 1</code>必须具有相同的 hash 值)。考虑到通过询问可以快速计算 hash 值，因此，我们可以考虑这几种方法：</p>
<ol>
<li>Hash<sub>1</sub> = <i>a</i><sub>1</sub> + <i>a</i><sub>2</sub> + ... + <i>a<sub>n</sub></i></li>
<li>Hash<sub>2</sub> = <i>a</i><sub>1</sub><sup>2</sup> + <i>a</i><sub>2</sub><sup>2</sup> + ... + <i>a<sub>n</sub></i><sup>2</sup></li>
<li>Hash<sub>3</sub> = <i>a</i><sub>1</sub> · <i>a</i><sub>2</sub> · ... · <i>a<sub>n</sub></i></li>
<li>Hash<sub>4</sub> = <i>a</i><sub>1</sub><sup>α</sup> + <i>a</i><sub>2</sub><sup>α</sup> + ... + <i>a<sub>n</sub><sup>α</sup></i>, 其中 α 为随机正整数</li>
</ol>
<p>(均值可以用 Hash<sub>1</sub> 计算，方差可以用 Hash<sub>1</sub> 和 Hash<sub>2</sub> 共同计算)</p>
<p>(scx: 感觉第 3 种和第 4 种很难实时计算啊)</p>
说得没错，第 3 和 4 种在实时计算的问题上就有了很大的麻烦 (当然还要膜拜一些愿意为 Hash<sub>4</sub> 写出 Bernoulli 数的超级大神犇 <s>(这样写理论上可以 AC)</s>)，所以只考虑 Hash<sub>1</sub> 和 Hash<sub>2</sub>。</p>
<p>Hash<sub>1</sub>的值就是等差数列前 n 项和，<s>学过高中数学必修 5 的自己应该会求</s>，没学过的自己<s>像 Gauss 一样</s>推一下，结果是<img src="https://latex.codecogs.com/gif.latex?\mathrm{Hash}_1=na_1+\frac{n(n-1)}2d" align="center">。</p>
<p>Hash<sub>2</sub>的值可以这样得到：<img src="https://latex.codecogs.com/gif.latex?\mathrm{Hash}_2=\sum_{i=0}^{n-1}(a_1+id)^2=\sum_{i=0}^{n-1}(a_1^2+2a_1di+d^2i^2)=na_1^2+a_1dn(n-1)+d^2\frac{n(n-1)(2n-1)}6" align="center">。</p>
<p>(scx: 我觉得把 Hash<sub>1</sub> 和 Hash<sub>2</sub> 都用上变成双 Hash 精确度应该会更高吧。)</p>
<p>很好，双 Hash 比单 Hash 的精确度高的不是一个层次，于是，有人就写了个双 Hash 的程序，就 AC 了。</p>
<p>很不幸，这是 lydsy 不是 uoj。如果是后者，那条 AC 记录最快可能在 10 分钟内变成 97 分(这也说明官方数据水到了一个境界)。</p>
<p>因为，容易证明可以存在两个<b>本质不同的</b>序列(即排序后不同)，它们的和与平方和均相等。</p>
<p>两个数肯定做不到(由韦达定理易证)，而三个数就很容易做到了，并且是存在<b>无穷多对正整数解</b>的。</p>
<p>最小的解为 (1, 5, 6) 和 (2, 3, 7) (容易验证和均为 12，平方和均为 62)。</p>
<p>所以，就有如下 Hack 数据(当然还有其它 Hack 数据)：</p>
<div class="panel-body">
<h4>input:</h4>
<pre>
8 9
1 2 3 4 5 6 7 8
2 1 8 1
1 3 2
1 7 5
1 6 9
2 0 9 0
1 3 3
1 7 7
1 6 6
2 0 9 0
</pre>
<h4>output:</h4>
<pre>
Yes
Yes
Yes
</pre>
<h4>answer:</h4>
<pre>
Yes
No
Yes
</pre>
</div>
<p id="std" name="std">下面讲正解，正解其实是想不到的简单。</p>
<p>我们只需开两个数组：prev[i] 记录 a[i] 在 i 之前最后出现的位置，next[i] 记录 a[i] 在 i 之后最前出现的位置，如果不存在则为 0。</p>
<p>这样第 3 个条件，即判断两两不重复可以用<code>max(prev[l], prev[l + 1], ..., prev[r]) &lt; l</code>代替，这是可以用线段树维护的。</p>
<p>(scx: 那如何保证修改的时间复杂度呢？)</p>
<p>由于出现的数最多 2n 个，所以用 2N 个 set 存储每个数出现的所有位置，这样在修改时照着 set 修改 prev[] 和 next[] 顺便把 set 的值调整一下，最后别忘记更新线段树，这样就保证了修改的时间复杂度。</p>
<p>因为这道题涉及到等差数列，又是强制在线，所以肯定不能离散化，万不得已，只能开个 map 来将数压缩到 set 的下标。<s>(我会告诉你其实我只是不想写平衡树吗)</s></p>
<p>然后修改就没问题了，那么别忘记把输入的东西异或一下，当然<code>op</code>不要异或，这道题就 AC 啦。</p>

<h2>代码</h2>

<link type="text/css" rel="stylesheet" href="../additional_files/css/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/css/sh_typical.min.css">

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> N <span class="sh_number">341468</span>
<span class="sh_preproc">#define</span> gcd __gcd
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">typedef</span> set <span class="sh_symbol">&lt;</span><span class="sh_type">int</span><span class="sh_symbol">&gt;</span> si<span class="sh_symbol">;</span>
<span class="sh_keyword">typedef</span> map <span class="sh_symbol">&lt;</span><span class="sh_type">int</span><span class="sh_symbol">,</span> <span class="sh_type">int</span><span class="sh_symbol">&gt;</span> mii<span class="sh_symbol">;</span>
<span class="sh_keyword">typedef</span> pair <span class="sh_symbol">&lt;</span><span class="sh_type">int</span><span class="sh_symbol">,</span> <span class="sh_type">int</span><span class="sh_symbol">&gt;</span> pii<span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">ST</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> sz<span class="sh_symbol">;</span>
    <span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">node</span><span class="sh_cbracket">{</span><span class="sh_type">int</span> Mx<span class="sh_symbol">,</span> Mn<span class="sh_symbol">,</span> d<span class="sh_symbol">,</span> Mp<span class="sh_symbol">;</span><span class="sh_cbracket">}</span><span class="sh_symbol">*</span>x<span class="sh_symbol">;</span>
    <span class="sh_function">ST</span> <span class="sh_symbol">()</span><span class="sh_cbracket">{</span>x <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_symbol">~</span><span class="sh_function">ST</span> <span class="sh_symbol">()</span><span class="sh_cbracket">{</span><span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_keyword">delete</span> <span class="sh_symbol">[]</span> <span class="sh_symbol">(</span>x<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">resize</span><span class="sh_symbol">(</span><span class="sh_type">int</span> size<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>sz <span class="sh_symbol">=</span> size<span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_keyword">delete</span> <span class="sh_symbol">[]</span> <span class="sh_symbol">(</span>x<span class="sh_symbol">);</span>
        x <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> node<span class="sh_symbol">[</span>sz <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">2</span><span class="sh_symbol">];</span> <span class="sh_function">memset</span><span class="sh_symbol">(</span>x<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> sz <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">4</span><span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">init</span><span class="sh_symbol">(</span><span class="sh_type">int</span> <span class="sh_symbol">*</span>data<span class="sh_symbol">,</span> <span class="sh_type">int</span> <span class="sh_symbol">*</span>data2<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>p <span class="sh_symbol">=</span> data<span class="sh_symbol">;</span> q <span class="sh_symbol">=</span> data2<span class="sh_symbol">;</span> <span class="sh_function">build</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">);</span> p <span class="sh_symbol">=</span> q <span class="sh_symbol">=</span> NULL<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">adj0</span><span class="sh_symbol">(</span><span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">adj0</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">adj1</span><span class="sh_symbol">(</span><span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">adj1</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">adj2</span><span class="sh_symbol">(</span><span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">adj2</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">bool</span> <span class="sh_function">test</span><span class="sh_symbol">(</span><span class="sh_type">int</span> l<span class="sh_symbol">,</span> <span class="sh_type">int</span> r<span class="sh_symbol">,</span> <span class="sh_type">int</span> d<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_usertype">node</span><span class="sh_normal"> </span>t<span class="sh_symbol">,</span> tt<span class="sh_symbol">;</span>
        <span class="sh_function">query</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> r<span class="sh_symbol">,</span> t<span class="sh_symbol">);</span>
        <span class="sh_function">query</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> sz<span class="sh_symbol">,</span> l <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> r<span class="sh_symbol">,</span> tt<span class="sh_symbol">);</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>d<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> t<span class="sh_symbol">.</span>Mx <span class="sh_symbol">==</span> t<span class="sh_symbol">.</span>Mn<span class="sh_symbol">;</span>
        <span class="sh_keyword">return</span> t<span class="sh_symbol">.</span>Mp <span class="sh_symbol">&lt;</span> l <span class="sh_symbol">&amp;&amp;</span> <span class="sh_symbol">(</span>t<span class="sh_symbol">.</span>Mx <span class="sh_symbol">-</span> t<span class="sh_symbol">.</span>Mn <span class="sh_symbol">==</span> <span class="sh_symbol">(</span>r <span class="sh_symbol">-</span> l<span class="sh_symbol">)</span> <span class="sh_symbol">*</span> d<span class="sh_symbol">)</span> <span class="sh_symbol">&amp;&amp;</span> <span class="sh_symbol">(</span><span class="sh_function">abs</span><span class="sh_symbol">(</span>tt<span class="sh_symbol">.</span>d<span class="sh_symbol">)</span> <span class="sh_symbol">==</span> d<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">int</span> <span class="sh_symbol">*</span>p<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>q<span class="sh_symbol">;</span>
    <span class="sh_type">void</span> <span class="sh_function">build</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mx <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mn <span class="sh_symbol">=</span> <span class="sh_symbol">*</span>p<span class="sh_symbol">;</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>d <span class="sh_symbol">=</span> <span class="sh_symbol">*</span>p <span class="sh_symbol">-</span> <span class="sh_symbol">*(</span>p <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mp <span class="sh_symbol">=</span> <span class="sh_symbol">*</span>q<span class="sh_symbol">;</span>
            p<span class="sh_symbol">++;</span> q<span class="sh_symbol">++;</span>
        <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
            <span class="sh_type">int</span> M <span class="sh_symbol">=</span> L <span class="sh_symbol">+</span> R <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Lc <span class="sh_symbol">=</span> id <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Rc <span class="sh_symbol">=</span> Lc <span class="sh_symbol">|</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
            <span class="sh_function">build</span><span class="sh_symbol">(</span>Lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">);</span>
            <span class="sh_function">build</span><span class="sh_symbol">(</span>Rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">);</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mx <span class="sh_symbol">=</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>Lc<span class="sh_symbol">].</span>Mx<span class="sh_symbol">,</span> x<span class="sh_symbol">[</span>Rc<span class="sh_symbol">].</span>Mx<span class="sh_symbol">);</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mn <span class="sh_symbol">=</span> <span class="sh_function">min</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>Lc<span class="sh_symbol">].</span>Mn<span class="sh_symbol">,</span> x<span class="sh_symbol">[</span>Rc<span class="sh_symbol">].</span>Mn<span class="sh_symbol">);</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>d <span class="sh_symbol">=</span> <span class="sh_function">gcd</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>Lc<span class="sh_symbol">].</span>d<span class="sh_symbol">,</span> x<span class="sh_symbol">[</span>Rc<span class="sh_symbol">].</span>d<span class="sh_symbol">);</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mp <span class="sh_symbol">=</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>Lc<span class="sh_symbol">].</span>Mp<span class="sh_symbol">,</span> x<span class="sh_symbol">[</span>Rc<span class="sh_symbol">].</span>Mp<span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">adj0</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mx <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mn <span class="sh_symbol">=</span> v<span class="sh_symbol">;</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
        <span class="sh_type">int</span> M <span class="sh_symbol">=</span> L <span class="sh_symbol">+</span> R <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Lc <span class="sh_symbol">=</span> id <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Rc <span class="sh_symbol">=</span> Lc <span class="sh_symbol">|</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
        h <span class="sh_symbol">&lt;=</span> M <span class="sh_symbol">?</span> <span class="sh_function">adj0</span><span class="sh_symbol">(</span>Lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">adj0</span><span class="sh_symbol">(</span>Rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
        x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mx <span class="sh_symbol">=</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>Lc<span class="sh_symbol">].</span>Mx<span class="sh_symbol">,</span> x<span class="sh_symbol">[</span>Rc<span class="sh_symbol">].</span>Mx<span class="sh_symbol">);</span>
        x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mn <span class="sh_symbol">=</span> <span class="sh_function">min</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>Lc<span class="sh_symbol">].</span>Mn<span class="sh_symbol">,</span> x<span class="sh_symbol">[</span>Rc<span class="sh_symbol">].</span>Mn<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">adj1</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>d <span class="sh_symbol">+=</span> v<span class="sh_symbol">;</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
        <span class="sh_type">int</span> M <span class="sh_symbol">=</span> L <span class="sh_symbol">+</span> R <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Lc <span class="sh_symbol">=</span> id <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Rc <span class="sh_symbol">=</span> Lc <span class="sh_symbol">|</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
        h <span class="sh_symbol">&lt;=</span> M <span class="sh_symbol">?</span> <span class="sh_function">adj1</span><span class="sh_symbol">(</span>Lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">adj1</span><span class="sh_symbol">(</span>Rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
        x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>d <span class="sh_symbol">=</span> <span class="sh_function">gcd</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>Lc<span class="sh_symbol">].</span>d<span class="sh_symbol">,</span> x<span class="sh_symbol">[</span>Rc<span class="sh_symbol">].</span>d<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">adj2</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mp <span class="sh_symbol">=</span> v<span class="sh_symbol">;</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
        <span class="sh_type">int</span> M <span class="sh_symbol">=</span> L <span class="sh_symbol">+</span> R <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Lc <span class="sh_symbol">=</span> id <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Rc <span class="sh_symbol">=</span> Lc <span class="sh_symbol">|</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
        h <span class="sh_symbol">&lt;=</span> M <span class="sh_symbol">?</span> <span class="sh_function">adj2</span><span class="sh_symbol">(</span>Lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">adj2</span><span class="sh_symbol">(</span>Rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
        x<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>Mp <span class="sh_symbol">=</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>Lc<span class="sh_symbol">].</span>Mp<span class="sh_symbol">,</span> x<span class="sh_symbol">[</span>Rc<span class="sh_symbol">].</span>Mp<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">query</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> ql<span class="sh_symbol">,</span> <span class="sh_type">int</span> qr<span class="sh_symbol">,</span> <span class="sh_usertype">node</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>result<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&gt;</span> R <span class="sh_symbol">||</span> qr <span class="sh_symbol">&lt;</span> L<span class="sh_symbol">)</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&lt;=</span> L <span class="sh_symbol">&amp;&amp;</span> qr <span class="sh_symbol">&gt;=</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>result <span class="sh_symbol">=</span> x<span class="sh_symbol">[</span>id<span class="sh_symbol">];</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">int</span> M <span class="sh_symbol">=</span> L <span class="sh_symbol">+</span> R <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Lc <span class="sh_symbol">=</span> id <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> Rc <span class="sh_symbol">=</span> Lc <span class="sh_symbol">|</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
        result<span class="sh_symbol">.</span>Mx <span class="sh_symbol">=</span> INT_MIN<span class="sh_symbol">;</span> result<span class="sh_symbol">.</span>Mn <span class="sh_symbol">=</span> INT_MAX<span class="sh_symbol">;</span>
        result<span class="sh_symbol">.</span>Mp <span class="sh_symbol">=</span> INT_MIN<span class="sh_symbol">;</span> result<span class="sh_symbol">.</span>d <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        <span class="sh_usertype">node</span><span class="sh_normal"> </span>tmp<span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&lt;=</span> M<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_function">query</span><span class="sh_symbol">(</span>Lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> ql<span class="sh_symbol">,</span> qr<span class="sh_symbol">,</span> tmp<span class="sh_symbol">);</span>
            result <span class="sh_symbol">=</span> tmp<span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>qr <span class="sh_symbol">&gt;</span> M<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_function">query</span><span class="sh_symbol">(</span>Rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> ql<span class="sh_symbol">,</span> qr<span class="sh_symbol">,</span> tmp<span class="sh_symbol">);</span>
            result<span class="sh_symbol">.</span>Mx <span class="sh_symbol">=</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>result<span class="sh_symbol">.</span>Mx<span class="sh_symbol">,</span> tmp<span class="sh_symbol">.</span>Mx<span class="sh_symbol">);</span>
            result<span class="sh_symbol">.</span>Mn <span class="sh_symbol">=</span> <span class="sh_function">min</span><span class="sh_symbol">(</span>result<span class="sh_symbol">.</span>Mn<span class="sh_symbol">,</span> tmp<span class="sh_symbol">.</span>Mn<span class="sh_symbol">);</span>
            result<span class="sh_symbol">.</span>d <span class="sh_symbol">=</span> <span class="sh_function">gcd</span><span class="sh_symbol">(</span>result<span class="sh_symbol">.</span>d<span class="sh_symbol">,</span> tmp<span class="sh_symbol">.</span>d<span class="sh_symbol">);</span>
            result<span class="sh_symbol">.</span>Mp <span class="sh_symbol">=</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>result<span class="sh_symbol">.</span>Mp<span class="sh_symbol">,</span> tmp<span class="sh_symbol">.</span>Mp<span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_type">int</span> n<span class="sh_symbol">,</span> q<span class="sh_symbol">,</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">;</span>
<span class="sh_type">int</span> ch<span class="sh_symbol">,</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> w<span class="sh_symbol">;</span>
<span class="sh_type">int</span> a<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> nid<span class="sh_symbol">,</span> id<span class="sh_symbol">;</span>
<span class="sh_type">int</span> prev<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> next<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>
<span class="sh_usertype">ST</span><span class="sh_normal"> </span>s<span class="sh_symbol">;</span>
<span class="sh_usertype">si</span><span class="sh_normal"> </span>ap<span class="sh_symbol">[</span>N <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
<span class="sh_usertype">mii</span><span class="sh_normal"> </span>mt<span class="sh_symbol">;</span>
si <span class="sh_symbol">::</span> <span class="sh_usertype">iterator</span><span class="sh_normal"> </span>sit<span class="sh_symbol">;</span>
mii <span class="sh_symbol">::</span> <span class="sh_usertype">iterator</span><span class="sh_normal"> </span>mit<span class="sh_symbol">;</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>q<span class="sh_symbol">);</span>
    s<span class="sh_symbol">.</span><span class="sh_function">resize</span><span class="sh_symbol">(</span>n<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>a<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> nid <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d"</span><span class="sh_symbol">,</span> a <span class="sh_symbol">+</span> i<span class="sh_symbol">);</span>
        mit <span class="sh_symbol">=</span> mt<span class="sh_symbol">.</span><span class="sh_function">find</span><span class="sh_symbol">(</span>a<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>mit <span class="sh_symbol">!=</span> mt<span class="sh_symbol">.</span><span class="sh_function">end</span><span class="sh_symbol">())</span><span class="sh_cbracket">{</span>
            id <span class="sh_symbol">=</span> mit<span class="sh_symbol">-&gt;</span>second<span class="sh_symbol">;</span>
            sit <span class="sh_symbol">=</span> ap<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span><span class="sh_function">insert</span><span class="sh_symbol">(</span>i<span class="sh_symbol">).</span>first<span class="sh_symbol">;</span>
            next<span class="sh_symbol">[</span>prev<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">*--</span>sit<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
            mt<span class="sh_symbol">.</span><span class="sh_function">insert</span><span class="sh_symbol">(</span><span class="sh_function">pii</span><span class="sh_symbol">(</span>a<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> id <span class="sh_symbol">=</span> <span class="sh_symbol">++</span>nid<span class="sh_symbol">));</span>
            ap<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span><span class="sh_function">insert</span><span class="sh_symbol">(</span>i<span class="sh_symbol">);</span>
            prev<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    s<span class="sh_symbol">.</span><span class="sh_function">init</span><span class="sh_symbol">(</span>a <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> prev <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> q<span class="sh_symbol">;</span> q<span class="sh_symbol">--)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span><span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>ch<span class="sh_symbol">),</span> ch <span class="sh_symbol">==</span> <span class="sh_number">1</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>u<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>v<span class="sh_symbol">);</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>a<span class="sh_symbol">[</span>u <span class="sh_symbol">^=</span> j<span class="sh_symbol">]</span> <span class="sh_symbol">==</span> <span class="sh_symbol">(</span>v <span class="sh_symbol">^=</span> j<span class="sh_symbol">))</span> <span class="sh_keyword">continue</span><span class="sh_symbol">;</span>
            id <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>mit <span class="sh_symbol">=</span> mt<span class="sh_symbol">.</span><span class="sh_function">find</span><span class="sh_symbol">(</span>a<span class="sh_symbol">[</span>u<span class="sh_symbol">]))-&gt;</span>second<span class="sh_symbol">;</span>
            sit <span class="sh_symbol">=</span> ap<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span><span class="sh_function">find</span><span class="sh_symbol">(</span>u<span class="sh_symbol">);</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>prev<span class="sh_symbol">[</span>u<span class="sh_symbol">])</span>
                next<span class="sh_symbol">[</span>prev<span class="sh_symbol">[</span>u<span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>u<span class="sh_symbol">];</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>next<span class="sh_symbol">[</span>u<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
                prev<span class="sh_symbol">[</span>next<span class="sh_symbol">[</span>u<span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> prev<span class="sh_symbol">[</span>u<span class="sh_symbol">];</span>
                s<span class="sh_symbol">.</span><span class="sh_function">adj2</span><span class="sh_symbol">(</span>next<span class="sh_symbol">[</span>u<span class="sh_symbol">],</span> prev<span class="sh_symbol">[</span>u<span class="sh_symbol">]);</span>
            <span class="sh_cbracket">}</span>
            ap<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span><span class="sh_function">erase</span><span class="sh_symbol">(</span>sit<span class="sh_symbol">);</span>
            mit <span class="sh_symbol">=</span> mt<span class="sh_symbol">.</span><span class="sh_function">find</span><span class="sh_symbol">(</span>v<span class="sh_symbol">);</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>mit <span class="sh_symbol">!=</span> mt<span class="sh_symbol">.</span><span class="sh_function">end</span><span class="sh_symbol">())</span><span class="sh_cbracket">{</span>
                id <span class="sh_symbol">=</span> mit<span class="sh_symbol">-&gt;</span>second<span class="sh_symbol">;</span>
                sit <span class="sh_symbol">=</span> ap<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span><span class="sh_function">insert</span><span class="sh_symbol">(</span>u<span class="sh_symbol">).</span>first<span class="sh_symbol">;</span>
                <span class="sh_keyword">if</span><span class="sh_symbol">(</span>sit <span class="sh_symbol">!=</span> ap<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span><span class="sh_function">begin</span><span class="sh_symbol">())</span><span class="sh_cbracket">{</span>
                    next<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> next<span class="sh_symbol">[*--</span>sit<span class="sh_symbol">];</span>
                    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>next<span class="sh_symbol">[</span>u<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
                        prev<span class="sh_symbol">[</span>next<span class="sh_symbol">[</span>u<span class="sh_symbol">]]</span> <span class="sh_symbol">=</span> u<span class="sh_symbol">;</span>
                        s<span class="sh_symbol">.</span><span class="sh_function">adj2</span><span class="sh_symbol">(</span>next<span class="sh_symbol">[</span>u<span class="sh_symbol">],</span> u<span class="sh_symbol">);</span>
                    <span class="sh_cbracket">}</span>
                    next<span class="sh_symbol">[*</span>sit<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> u<span class="sh_symbol">;</span>
                    prev<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">*</span>sit<span class="sh_symbol">;</span>
                    s<span class="sh_symbol">.</span><span class="sh_function">adj2</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>sit<span class="sh_symbol">);</span>
                <span class="sh_cbracket">}</span><span class="sh_keyword">else</span> <span class="sh_keyword">if</span><span class="sh_symbol">(++</span>sit <span class="sh_symbol">!=</span> ap<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span><span class="sh_function">end</span><span class="sh_symbol">())</span><span class="sh_cbracket">{</span>
                    next<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">*</span>sit<span class="sh_symbol">;</span>
                    prev<span class="sh_symbol">[*</span>sit<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> u<span class="sh_symbol">;</span>
                    s<span class="sh_symbol">.</span><span class="sh_function">adj2</span><span class="sh_symbol">(*</span>sit<span class="sh_symbol">,</span> u<span class="sh_symbol">);</span>
                <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
                    prev<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
                    s<span class="sh_symbol">.</span><span class="sh_function">adj2</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
                <span class="sh_cbracket">}</span>
            <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
                mt<span class="sh_symbol">.</span><span class="sh_function">insert</span><span class="sh_symbol">(</span><span class="sh_function">pii</span><span class="sh_symbol">(</span>v<span class="sh_symbol">,</span> id <span class="sh_symbol">=</span> <span class="sh_symbol">++</span>nid<span class="sh_symbol">));</span>
                sit <span class="sh_symbol">=</span> ap<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span><span class="sh_function">insert</span><span class="sh_symbol">(</span>i<span class="sh_symbol">).</span>first<span class="sh_symbol">;</span>
                ap<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span><span class="sh_function">insert</span><span class="sh_symbol">(</span>u<span class="sh_symbol">);</span>
                prev<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
                s<span class="sh_symbol">.</span><span class="sh_function">adj2</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
            <span class="sh_cbracket">}</span>
            s<span class="sh_symbol">.</span><span class="sh_function">adj0</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
            s<span class="sh_symbol">.</span><span class="sh_function">adj1</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v <span class="sh_symbol">-</span> a<span class="sh_symbol">[</span>u<span class="sh_symbol">]);</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>u <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">)</span> s<span class="sh_symbol">.</span><span class="sh_function">adj1</span><span class="sh_symbol">(</span>u <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> a<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> v<span class="sh_symbol">);</span>
            a<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> v<span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
            <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>u<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>v<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>w<span class="sh_symbol">);</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">((</span>u <span class="sh_symbol">^=</span> j<span class="sh_symbol">)</span> <span class="sh_symbol">==</span> <span class="sh_symbol">(</span>v <span class="sh_symbol">^=</span> j<span class="sh_symbol">))</span><span class="sh_cbracket">{</span>
                <span class="sh_function">puts</span><span class="sh_symbol">(</span><span class="sh_string">"Yes"</span><span class="sh_symbol">);</span> <span class="sh_symbol">++</span>j<span class="sh_symbol">;</span> <span class="sh_keyword">continue</span><span class="sh_symbol">;</span>
            <span class="sh_cbracket">}</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">.</span><span class="sh_function">test</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> w <span class="sh_symbol">^=</span> j<span class="sh_symbol">))</span><span class="sh_cbracket">{</span>
                <span class="sh_function">puts</span><span class="sh_symbol">(</span><span class="sh_string">"Yes"</span><span class="sh_symbol">);</span> <span class="sh_symbol">++</span>j<span class="sh_symbol">;</span>
            <span class="sh_cbracket">}</span><span class="sh_keyword">else</span>
                <span class="sh_function">puts</span><span class="sh_symbol">(</span><span class="sh_string">"No"</span><span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

</code></pre></div>

<h2>坑</h2>
<p>坑的话，还是比较少的。主要是以下几个：</p>
<p><b>坑1：</b>修改的时候，涉及到 prev 的，千万不要忘记更新线段树的值，然后，线段树需要保证修改的 id &gt; 0，不然会 WA。</p>
<p><b>坑2：</b>询问的时候，prev[], max[], min[] 数组都是 [l, r] 查询的，而 gcd[] 是 [l + 1, r] 查询的，顺便还要特判以下当<code>l == r</code>时输出<code>Yes</code>，<code>k == 0</code>时只需判断最大值等于最小值。</p>

<h2 id="cancer" name="cancer">毒瘤</h2>
<p><s>(scx: 毒瘤是什么东西，能吃吗？)</s></p>
<p>这道题，因为编程复杂度巨大<s>(我是不会告诉你我码了 175 行的)</s>，所以我找来提交记录，随机抽取一群人提交了多少次才 AC ... (由于保密的原因，以下只给，我的为第一行)。</p>
<table border="10">
<tr><th align="center" width="80">  id  </th><th align="center" width="80"> MLE </th><th align="center" width="80"> TLE </th><th align="center" width="80"> RE </th><th align="center" width="80"> WA </th><th align="center" width="80"> AC </th><th align="center" width="80">  All  </th></tr>
<tr><td align="center"> 5491 </td><td align="center">  0  </td><td align="center">  0  </td><td align="center"> 4  </td><td align="center"> 3  </td><td align="center"> 1  </td><td align="center"> 7 + 1 </td></tr>
<tr><td align="center"> 1930 </td><td align="center">  4  </td><td align="center">  16 </td><td align="center"> 5  </td><td align="center"> 9  </td><td align="center"> 2  </td><td align="center"> 34 + 2 </td></tr>
<tr><td align="center"> 2630 </td><td align="center">  0  </td><td align="center">  4  </td><td align="center"> 2  </td><td align="center"> 1  </td><td align="center"> 1  </td><td align="center"> 7 + 1 </td></tr>
<tr><td align="center"> 2383 </td><td align="center">  0  </td><td align="center">  0  </td><td align="center"> 0  </td><td align="center"> 0  </td><td align="center"> 1  </td><td align="center"> 0 + 1 </td></tr>
<tr><td align="center"> 1046 </td><td align="center">  0  </td><td align="center">  3  </td><td align="center"> 5  </td><td align="center"> 8  </td><td align="center"> 1  </td><td align="center"> 16 + 1 </td></tr>
<tr><td align="center"> 3946 </td><td align="center">  2  </td><td align="center">  0  </td><td align="center"> 35 </td><td align="center"> 1  </td><td align="center"> 3  </td><td align="center"> 38 + 3 </td></tr>
<tr><td align="center"> 4697 </td><td align="center">  0  </td><td align="center">  0  </td><td align="center"> 6  </td><td align="center"> 5  </td><td align="center"> 1  </td><td align="center"> 11 + 1 </td></tr>
<tr><td align="center"> 3176 </td><td align="center">  1  </td><td align="center">  0  </td><td align="center"> 13 </td><td align="center"> 0  </td><td align="center"> 0  </td><td align="center"> 14 + 0 </td></tr>
<tr><td align="center"> 7526 </td><td align="center">  0  </td><td align="center">  11 </td><td align="center"> 1  </td><td align="center"> 0  </td><td align="center"> 8  </td><td align="center"> 12 + 8 </td></tr>
</table>
<p>然后我它喵地发现两个号 id 可以相同 ......</p>
<p>话说你也发现了 RE 的人是最多的。其实强制在线的题目，只要中途有一个 WA 了(比如说答案错误，Yes No 输反)，就会导致你的密钥错误，然后会导致你解密出来的信息是乱七八糟的，于是乎就会让你华丽地 RE。</p>
因此说，遇到强制在线的题目，如果你 RE 了(还有部分 TLE 也是)，一般要想一想是不是 WA 了。</p>
