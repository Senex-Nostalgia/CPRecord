<h2>题目描述</h2>
<p>在一片古老的土地上，有 <i>V</i> 座城坐落其中，形成树的结构。</p>
<p>根据 scx 的调查，大陆上一共有 <i>n</i> 名受封骑士，编号为 1 到 <i>n</i>，其中，骑士 <i>i</i> <b>居住地</b>为城 <i>P<sub>i</sub></i>，<b>武力值</b>为 <i>F<sub>i</sub></i>。</p>
<p>scx 计划进行若干次旅行，每次从一座城出发<b>沿着唯一的简单路径</b>前往另一座城，同时会挑战路线上武力值最高的 <i>k</i> 个骑士 (由于她的体力有限，为了提高水平，当然要挑战最强的骑士)。</p>
<p>如果路线上的骑士不足 <i>k</i> 人，scx 会挑战遇到的所有人。</p>
<p>每次旅行前，可能会有某些骑士的<b>武力值</b>或<b>居住地</b>发生变化，scx 自然会打听消息，并对计划做出调整。</p>
<p>为了在每次旅行时做好充分准备，你需要帮她在每次旅行前计算出这条路线上她将挑战哪些对手。</p>

<h2>输入格式</h2>
<p>第一行包含一个整数 <i>V</i>，表示有 <i>V</i> 座城，编号为 1, 2, ..., <i>V</i>。</p>
<p>接下来的 <i>V</i> - 1 行，每行两个整数 <i>u<sub>i</sub></i> 和 <i>v<sub>i</sub></i>，表示城 <i>u<sub>i</sub></i> 和城 <i>v<sub>i</sub></i> 之间有一条道路相连。</p>
<p>接下来的一行，一个整数 <i>n</i>，表示骑士的个数。</p>
<p>接下来的 <i>n</i> 行，每行两个整数 <i>F<sub>i</sub></i> 和 <i>P<sub>i</sub></i>。按顺序依次表示编号为 1 ~ M 的每名骑士的<b>武力值</b>和<b>居住地</b>。</p>
<p>接下来的一行包含两个整数 <i>Q</i>, <i>k</i>，分别表示操作次数和每次旅行挑战的骑士数目上限。</p>
<p>接下来 <i>Q</i> 行，每行三个整数 <i>T<sub>i</sub></i>, <i>x<sub>i</sub></i>, <i>y<sub>i</sub></i>。<i>T<sub>i</sub></i> 的取值范围为 {1, 2, 3}，表示操作类型，共有以下三种类型的操作：</p>
<ol>
<li>表示一次旅行，scx 将从城 <i>x<sub>i</sub></i> 出发前往城市 <i>y<sub>i</sub></i>；</li>
<li>表示 <i>P<sub>x<sub>i</sub></sub></i> ← <i>y<sub>i</sub></i>；</li>
<li>表示 <i>F<sub>x<sub>i</sub></sub></i> ← <i>y<sub>i</sub></i>；</li>
</ol>

<h2>输出格式</h2>
<p>输出若干行，依次为每个旅行的答案。</p>
<p>对每个 <i>T<sub>i</sub></i> = 1 的询问，输出一行，按<b>从大到小</b>的顺序输出 scx 在这次旅行中挑战的所有骑士的武力值。如果路线上没有骑士，输出 <code>-1</code>。</p>

<h2>题解</h2>
<p>这种树上维护<s>乱七八糟</s>东西的题目显然用树链剖分吧~</p>
<p>然后再用 dfs 序套个线段树也没什么毛病~</p>
<p>这道题有一个非常<s>棒棒</s>的性质：<i>k</i> ≤ 20。</p>
<p>所以可以在线段树上存储线段树对应的区间中<b>所有骑士中前 <i>k</i> 大的武力值</b> (放心，不会 MLE 的)。</p>
<p>由于可能因为某些骑士搬迁，所以武力值低的骑士可能会后来居上，所以可以在线段树<b>底层</b>的每个 (叶子) 节点用一个 <code>multiset</code> 存储居住在对应节点上的所有骑士的武力值。</p>
<p>那么线段树更新和询问的时候，写个 <img src="http://latex.codecogs.com/gif.latex?O(\log%20n)"> 路归并即可，可以用堆实现，复杂度为 <img src="http://latex.codecogs.com/gif.latex?\Theta(k\log\log%20n)">。</p>
<p>或者也可以不用堆 <s>(像我一样懒的孩纸)</s>，直接做 <img src="http://latex.codecogs.com/gif.latex?O(\log%20n)"> 次二路归并，不过有个小建议，尽量不要使用 STL 的 <code>merge()</code> 函数，手写 (跑) 的时间大概是它的 1/3，这样虽然比堆跑得慢一点，但还是可以<s>卡</s>过去的。</p>
<p>(用堆的算法的) 时间复杂度大约为 <img src="http://latex.codecogs.com/gif.latex?\Theta(Q\left(\log^2n+k\right)\log\log%20n)"> (预处理的忽略不计)。</p>

<h2>代码</h2>

<link type="text/css" rel="stylesheet" href="../additional_files/css/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/css/sh_typical.min.css">

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> maxV <span class="sh_number">42684</span>
<span class="sh_preproc">#define</span> maxE <span class="sh_number">85367</span>
<span class="sh_preproc">#define</span> maxN <span class="sh_number">42684</span>
<span class="sh_preproc">#define</span> <span class="sh_usertype">ID</span><span class="sh_normal"> </span><span class="sh_function">isdigit</span><span class="sh_symbol">(</span>c <span class="sh_symbol">=</span> <span class="sh_symbol">*</span>next<span class="sh_symbol">++)</span>
<span class="sh_preproc">#define</span> <span class="sh_usertype">RT</span><span class="sh_normal"> </span><span class="sh_keyword">if</span><span class="sh_symbol">(</span>c <span class="sh_symbol">&lt;</span> <span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_keyword">return</span> flag <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span>
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">Istream</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> flag<span class="sh_symbol">;</span> <span class="sh_type">char</span> <span class="sh_symbol">*</span>next<span class="sh_symbol">,</span> buf<span class="sh_symbol">[</span><span class="sh_number">6829360</span><span class="sh_symbol">];</span>
    <span class="sh_type">void</span> <span class="sh_function">init</span><span class="sh_symbol">(</span><span class="sh_usertype">FILE</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>f <span class="sh_symbol">=</span> stdin<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">fread</span><span class="sh_symbol">(</span>buf<span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> buf<span class="sh_symbol">,</span> f<span class="sh_symbol">);</span> next <span class="sh_symbol">=</span> buf<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    Istream<span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_type">int</span> c<span class="sh_symbol">,</span> l <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> x <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> <span class="sh_symbol">!</span>ID<span class="sh_symbol">;</span> l <span class="sh_symbol">=</span> c<span class="sh_symbol">)</span> RT<span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>x <span class="sh_symbol">=</span> c <span class="sh_symbol">-</span> <span class="sh_number">48</span><span class="sh_symbol">;</span> ID<span class="sh_symbol">;</span> x <span class="sh_symbol">=</span> x <span class="sh_symbol">*</span> <span class="sh_number">10</span> <span class="sh_symbol">+</span> <span class="sh_symbol">(</span>c <span class="sh_symbol">-</span> <span class="sh_number">48</span><span class="sh_symbol">))</span> RT<span class="sh_symbol">;</span> RT<span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>l <span class="sh_symbol">==</span> <span class="sh_number">45</span><span class="sh_symbol">)</span> x <span class="sh_symbol">=</span> <span class="sh_symbol">-</span>x<span class="sh_symbol">;</span>
        <span class="sh_keyword">return</span> flag <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">char</span> <span class="sh_function">get</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_symbol">*</span>next<span class="sh_symbol">++;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">operator</span> <span class="sh_type">void</span> <span class="sh_symbol">*()</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> flag <span class="sh_symbol">?</span> <span class="sh_keyword">this</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>Cin<span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">Ostream</span><span class="sh_cbracket">{</span>
    FILE <span class="sh_symbol">*</span>_f<span class="sh_symbol">;</span> <span class="sh_type">char</span> buf<span class="sh_symbol">[</span><span class="sh_number">34</span><span class="sh_symbol">];</span>
    <span class="sh_type">void</span> <span class="sh_function">init</span><span class="sh_symbol">(</span><span class="sh_usertype">FILE</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>f <span class="sh_symbol">=</span> stdout<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>_f <span class="sh_symbol">=</span> f<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    Ostream<span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;&lt;</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>x<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_function">put</span><span class="sh_symbol">(</span><span class="sh_number">48</span><span class="sh_symbol">),</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x <span class="sh_symbol">&lt;</span> <span class="sh_number">0</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">put</span><span class="sh_symbol">(</span><span class="sh_number">45</span><span class="sh_symbol">);</span> x <span class="sh_symbol">=</span> <span class="sh_symbol">-</span>x<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> x <span class="sh_symbol">&gt;</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> x <span class="sh_symbol">/=</span> <span class="sh_number">10</span><span class="sh_symbol">)</span> buf<span class="sh_symbol">[</span>i<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> x <span class="sh_symbol">%</span> <span class="sh_number">10</span> <span class="sh_symbol">+</span> <span class="sh_number">48</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">while</span><span class="sh_symbol">(--</span>i <span class="sh_symbol">&gt;=</span> <span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_function">put</span><span class="sh_symbol">(</span>buf<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
        <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    Ostream<span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;&lt;</span> <span class="sh_symbol">(</span><span class="sh_type">char</span> c<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">put</span><span class="sh_symbol">(</span>c<span class="sh_symbol">),</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    Ostream<span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;&lt;</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">char</span> <span class="sh_symbol">*</span>s<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">char</span> <span class="sh_symbol">*</span>p <span class="sh_symbol">=</span> <span class="sh_symbol">(</span><span class="sh_type">char</span><span class="sh_symbol">*)</span>s<span class="sh_symbol">;</span> <span class="sh_symbol">*</span>p<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>p<span class="sh_symbol">)</span> <span class="sh_function">put</span><span class="sh_symbol">(*</span>p<span class="sh_symbol">);</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">put</span><span class="sh_symbol">(</span><span class="sh_type">char</span> c<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">fputc</span><span class="sh_symbol">(</span>c<span class="sh_symbol">,</span> _f<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>Cout<span class="sh_symbol">;</span>
<span class="sh_comment">// cin &amp; cout</span>

<span class="sh_keyword">typedef</span> multiset <span class="sh_symbol">&lt;</span><span class="sh_type">int</span><span class="sh_symbol">,</span> greater <span class="sh_symbol">&lt;</span><span class="sh_type">int</span><span class="sh_symbol">&gt;</span> <span class="sh_symbol">&gt;</span> mset<span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">edge</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">;</span>
    <span class="sh_function">edge</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> u0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> v0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">):</span> <span class="sh_function">u</span><span class="sh_symbol">(</span>u0<span class="sh_symbol">),</span> <span class="sh_function">v</span><span class="sh_symbol">(</span>v0<span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">knight</span><span class="sh_cbracket">{</span><span class="sh_type">int</span> n<span class="sh_symbol">,</span> f<span class="sh_symbol">[</span><span class="sh_number">40</span><span class="sh_symbol">];</span><span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_type">int</span> V<span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> q<span class="sh_symbol">,</span> lim<span class="sh_symbol">;</span>
<span class="sh_type">int</span> i<span class="sh_symbol">,</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> ch<span class="sh_symbol">;</span>
<span class="sh_usertype">edge</span><span class="sh_normal"> </span>e<span class="sh_symbol">[</span>maxE<span class="sh_symbol">];</span>
<span class="sh_type">int</span> first<span class="sh_symbol">[</span>maxV<span class="sh_symbol">],</span> next<span class="sh_symbol">[</span>maxE<span class="sh_symbol">];</span>
<span class="sh_type">int</span> sz<span class="sh_symbol">[</span>maxV<span class="sh_symbol">],</span> p<span class="sh_symbol">[</span>maxV<span class="sh_symbol">],</span> dep<span class="sh_symbol">[</span>maxV<span class="sh_symbol">];</span> <span class="sh_comment">// dfs_weight</span>
<span class="sh_type">int</span> cnt<span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>maxV<span class="sh_symbol">],</span> id<span class="sh_symbol">[</span>maxV<span class="sh_symbol">];</span> <span class="sh_comment">// dfs_main_chain</span>
<span class="sh_type">int</span> fgt<span class="sh_symbol">[</span>maxN<span class="sh_symbol">],</span> pos<span class="sh_symbol">[</span>maxN<span class="sh_symbol">];</span>
<span class="sh_usertype">knight</span><span class="sh_normal"> </span>st<span class="sh_symbol">[</span>maxV <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">3</span><span class="sh_symbol">];</span>
<span class="sh_usertype">mset</span><span class="sh_normal"> </span>fgts<span class="sh_symbol">[</span>maxV<span class="sh_symbol">];</span>

<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span><span class="sh_type">int</span> u<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">,</span> <span class="sh_type">int</span> id<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>e<span class="sh_symbol">[</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">edge</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span> next<span class="sh_symbol">[</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">];</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> id<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">up</span><span class="sh_symbol">(</span><span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> y<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>x <span class="sh_symbol">&gt;</span> y <span class="sh_symbol">?</span> x <span class="sh_symbol">=</span> y <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">Merge</span><span class="sh_symbol">(</span><span class="sh_usertype">knight</span><span class="sh_normal"> </span>A<span class="sh_symbol">,</span> <span class="sh_usertype">knight</span><span class="sh_normal"> </span>B<span class="sh_symbol">,</span> <span class="sh_usertype">knight</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>C<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> j <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>C<span class="sh_symbol">-&gt;</span>n <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> C<span class="sh_symbol">-&gt;</span>n <span class="sh_symbol">&lt;</span> lim <span class="sh_symbol">&amp;&amp;</span> <span class="sh_symbol">(</span>i <span class="sh_symbol">&lt;</span> A<span class="sh_symbol">.</span>n <span class="sh_symbol">||</span> j <span class="sh_symbol">&lt;</span> B<span class="sh_symbol">.</span>n<span class="sh_symbol">);</span> <span class="sh_symbol">++</span>C<span class="sh_symbol">-&gt;</span>n<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>i <span class="sh_symbol">==</span> A<span class="sh_symbol">.</span>n<span class="sh_symbol">)</span> C<span class="sh_symbol">-&gt;</span>f<span class="sh_symbol">[</span>C<span class="sh_symbol">-&gt;</span>n<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> B<span class="sh_symbol">.</span>f<span class="sh_symbol">[</span>j<span class="sh_symbol">++];</span>
        <span class="sh_keyword">else</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>j <span class="sh_symbol">==</span> B<span class="sh_symbol">.</span>n<span class="sh_symbol">)</span> C<span class="sh_symbol">-&gt;</span>f<span class="sh_symbol">[</span>C<span class="sh_symbol">-&gt;</span>n<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> A<span class="sh_symbol">.</span>f<span class="sh_symbol">[</span>i<span class="sh_symbol">++];</span>
        <span class="sh_keyword">else</span> C<span class="sh_symbol">-&gt;</span>f<span class="sh_symbol">[</span>C<span class="sh_symbol">-&gt;</span>n<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>A<span class="sh_symbol">.</span>f<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;</span> B<span class="sh_symbol">.</span>f<span class="sh_symbol">[</span>j<span class="sh_symbol">]</span> <span class="sh_symbol">?</span> B<span class="sh_symbol">.</span>f<span class="sh_symbol">[</span>j<span class="sh_symbol">++]</span> <span class="sh_symbol">:</span> A<span class="sh_symbol">.</span>f<span class="sh_symbol">[</span>i<span class="sh_symbol">++]);</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">dfs_weight</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> y<span class="sh_symbol">;</span>
    sz<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">((</span>y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">)</span> <span class="sh_symbol">!=</span> p<span class="sh_symbol">[</span>x<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
            p<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> x<span class="sh_symbol">;</span>
            dep<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> dep<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
            <span class="sh_function">dfs_weight</span><span class="sh_symbol">(</span>y<span class="sh_symbol">);</span>
            sz<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> sz<span class="sh_symbol">[</span>y<span class="sh_symbol">];</span>
        <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">dfs_mc</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">,</span> <span class="sh_type">int</span> r<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> y<span class="sh_symbol">,</span> z <span class="sh_symbol">=</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">;</span>
    o<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">++</span>cnt<span class="sh_symbol">;</span> id<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> r<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>id<span class="sh_symbol">[</span>y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">])</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>z <span class="sh_symbol">==</span> <span class="sh_symbol">-</span><span class="sh_number">1</span> <span class="sh_symbol">||</span> sz<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;</span> sz<span class="sh_symbol">[</span>z<span class="sh_symbol">])</span> z <span class="sh_symbol">=</span> y<span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>z <span class="sh_symbol">==</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span>
    <span class="sh_function">dfs_mc</span><span class="sh_symbol">(</span>z<span class="sh_symbol">,</span> r<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>id<span class="sh_symbol">[</span>y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">])</span>
            <span class="sh_function">dfs_mc</span><span class="sh_symbol">(</span>y<span class="sh_symbol">,</span> y<span class="sh_symbol">);</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">,</span> <span class="sh_type">bool</span> remove <span class="sh_symbol">=</span> <span class="sh_keyword">false</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">==</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        mset<span class="sh_symbol">::</span><span class="sh_usertype">iterator</span><span class="sh_normal"> </span>it<span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>remove<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>it <span class="sh_symbol">=</span> fgts<span class="sh_symbol">[</span>L<span class="sh_symbol">].</span><span class="sh_function">find</span><span class="sh_symbol">(</span>v<span class="sh_symbol">);</span> fgts<span class="sh_symbol">[</span>L<span class="sh_symbol">].</span><span class="sh_function">erase</span><span class="sh_symbol">(</span>it<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
        <span class="sh_keyword">else</span> fgts<span class="sh_symbol">[</span>L<span class="sh_symbol">].</span><span class="sh_function">insert</span><span class="sh_symbol">(</span>v<span class="sh_symbol">);</span>
        st<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>n <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>it <span class="sh_symbol">=</span> fgts<span class="sh_symbol">[</span>L<span class="sh_symbol">].</span><span class="sh_function">begin</span><span class="sh_symbol">();</span> it <span class="sh_symbol">!=</span> fgts<span class="sh_symbol">[</span>L<span class="sh_symbol">].</span><span class="sh_function">end</span><span class="sh_symbol">()</span> <span class="sh_symbol">&amp;&amp;</span> st<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>n <span class="sh_symbol">&lt;</span> lim<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>it<span class="sh_symbol">)</span>
            st<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>f<span class="sh_symbol">[</span>st<span class="sh_symbol">[</span>id<span class="sh_symbol">].</span>n<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">*</span>it<span class="sh_symbol">;</span>
        <span class="sh_keyword">return</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_type">int</span> M <span class="sh_symbol">=</span> L <span class="sh_symbol">+</span> R <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> lc <span class="sh_symbol">=</span> id <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> rc <span class="sh_symbol">=</span> lc <span class="sh_symbol">|</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    h <span class="sh_symbol">&lt;=</span> M <span class="sh_symbol">?</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> remove<span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> h<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> remove<span class="sh_symbol">);</span>
    <span class="sh_function">Merge</span><span class="sh_symbol">(</span>st<span class="sh_symbol">[</span>lc<span class="sh_symbol">],</span> st<span class="sh_symbol">[</span>rc<span class="sh_symbol">],</span> st <span class="sh_symbol">+</span> id<span class="sh_symbol">);</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">query</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id<span class="sh_symbol">,</span> <span class="sh_type">int</span> L<span class="sh_symbol">,</span> <span class="sh_type">int</span> R<span class="sh_symbol">,</span> <span class="sh_type">int</span> ql<span class="sh_symbol">,</span> <span class="sh_type">int</span> qr<span class="sh_symbol">,</span> knight<span class="sh_symbol">&amp;</span> res<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&lt;=</span> L <span class="sh_symbol">&amp;&amp;</span> qr <span class="sh_symbol">&gt;=</span> R<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>res <span class="sh_symbol">=</span> st<span class="sh_symbol">[</span>id<span class="sh_symbol">];</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_type">int</span> M <span class="sh_symbol">=</span> L <span class="sh_symbol">+</span> R <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">&gt;&gt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> lc <span class="sh_symbol">=</span> id <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> rc <span class="sh_symbol">=</span> lc <span class="sh_symbol">|</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_usertype">knight</span><span class="sh_normal"> </span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">;</span> u<span class="sh_symbol">.</span>n <span class="sh_symbol">=</span> v<span class="sh_symbol">.</span>n <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ql <span class="sh_symbol">&lt;=</span> M<span class="sh_symbol">)</span> <span class="sh_function">query</span><span class="sh_symbol">(</span>lc<span class="sh_symbol">,</span> L<span class="sh_symbol">,</span> M<span class="sh_symbol">,</span> ql<span class="sh_symbol">,</span> <span class="sh_function">min</span><span class="sh_symbol">(</span>qr<span class="sh_symbol">,</span> M<span class="sh_symbol">),</span> u<span class="sh_symbol">);</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>qr <span class="sh_symbol">&gt;</span> M<span class="sh_symbol">)</span> <span class="sh_function">query</span><span class="sh_symbol">(</span>rc<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> R<span class="sh_symbol">,</span> <span class="sh_function">max</span><span class="sh_symbol">(</span>ql<span class="sh_symbol">,</span> M <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">),</span> qr<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
    <span class="sh_function">Merge</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>res<span class="sh_symbol">);</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">solve</span><span class="sh_symbol">(</span><span class="sh_type">int</span> u<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> x <span class="sh_symbol">=</span> id<span class="sh_symbol">[</span>u<span class="sh_symbol">],</span> y <span class="sh_symbol">=</span> id<span class="sh_symbol">[</span>v<span class="sh_symbol">];</span>
    <span class="sh_usertype">knight</span><span class="sh_normal"> </span>knight1<span class="sh_symbol">,</span> knight2<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>ans <span class="sh_symbol">=</span> <span class="sh_symbol">&amp;</span>knight1<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>mgd <span class="sh_symbol">=</span> <span class="sh_symbol">&amp;</span>knight2<span class="sh_symbol">,</span> tmp<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>ans<span class="sh_symbol">-&gt;</span>n <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> x <span class="sh_symbol">!=</span> y<span class="sh_symbol">;</span> x <span class="sh_symbol">=</span> id<span class="sh_symbol">[</span>u<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>dep<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;</span> dep<span class="sh_symbol">[</span>y<span class="sh_symbol">])</span><span class="sh_cbracket">{</span><span class="sh_function">swap</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span> <span class="sh_function">swap</span><span class="sh_symbol">(</span>x<span class="sh_symbol">,</span> y<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
        <span class="sh_function">query</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>x<span class="sh_symbol">],</span> o<span class="sh_symbol">[</span>u<span class="sh_symbol">],</span> tmp<span class="sh_symbol">);</span>
        <span class="sh_function">Merge</span><span class="sh_symbol">(*</span>ans<span class="sh_symbol">,</span> tmp<span class="sh_symbol">,</span> mgd<span class="sh_symbol">);</span>
        <span class="sh_function">swap</span><span class="sh_symbol">(</span>ans<span class="sh_symbol">,</span> mgd<span class="sh_symbol">);</span>
        u <span class="sh_symbol">=</span> p<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>dep<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;</span> dep<span class="sh_symbol">[</span>v<span class="sh_symbol">])</span> <span class="sh_function">swap</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
    <span class="sh_function">query</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>u<span class="sh_symbol">],</span> o<span class="sh_symbol">[</span>v<span class="sh_symbol">],</span> tmp<span class="sh_symbol">);</span>
    <span class="sh_function">Merge</span><span class="sh_symbol">(*</span>ans<span class="sh_symbol">,</span> tmp<span class="sh_symbol">,</span> mgd<span class="sh_symbol">);</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>mgd<span class="sh_symbol">-&gt;</span>n<span class="sh_symbol">)</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> mgd<span class="sh_symbol">-&gt;</span>n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span>
            Cout <span class="sh_symbol">&lt;&lt;</span> mgd<span class="sh_symbol">-&gt;</span>f<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;&lt;</span> <span class="sh_string">' '</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">else</span>
        Cout <span class="sh_symbol">&lt;&lt;</span> <span class="sh_string">"-1"</span><span class="sh_symbol">;</span>
    Cout <span class="sh_symbol">&lt;&lt;</span> <span class="sh_string">'</span><span class="sh_specialchar">\n</span><span class="sh_string">'</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    Cin<span class="sh_symbol">.</span><span class="sh_function">init</span><span class="sh_symbol">();</span>
    Cout<span class="sh_symbol">.</span><span class="sh_function">init</span><span class="sh_symbol">();</span>
    Cin <span class="sh_symbol">&gt;&gt;</span> V<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> V<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
        Cin <span class="sh_symbol">&gt;&gt;</span> u <span class="sh_symbol">&gt;&gt;</span> v<span class="sh_symbol">;</span>
        <span class="sh_function">addedge</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> <span class="sh_symbol">(</span>i <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
        <span class="sh_function">addedge</span><span class="sh_symbol">(</span>v<span class="sh_symbol">,</span> u<span class="sh_symbol">,</span> i <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_function">dfs_weight</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">);</span>
    <span class="sh_function">dfs_mc</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
    Cin <span class="sh_symbol">&gt;&gt;</span> n<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> Cin <span class="sh_symbol">&gt;&gt;</span> fgt<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;&gt;</span> pos<span class="sh_symbol">[</span>i<span class="sh_symbol">];</span>
    Cin <span class="sh_symbol">&gt;&gt;</span> q <span class="sh_symbol">&gt;&gt;</span> lim<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>pos<span class="sh_symbol">[</span>i<span class="sh_symbol">]],</span> fgt<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> q<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>q<span class="sh_symbol">)</span>
        <span class="sh_keyword">switch</span><span class="sh_symbol">(</span>Cin <span class="sh_symbol">&gt;&gt;</span> ch <span class="sh_symbol">&gt;&gt;</span> u <span class="sh_symbol">&gt;&gt;</span> v<span class="sh_symbol">,</span> ch<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">case</span> <span class="sh_number">1</span><span class="sh_symbol">:</span>
                <span class="sh_function">solve</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
                <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
            <span class="sh_keyword">case</span> <span class="sh_number">2</span><span class="sh_symbol">:</span>
                <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>pos<span class="sh_symbol">[</span>u<span class="sh_symbol">]],</span> fgt<span class="sh_symbol">[</span>u<span class="sh_symbol">],</span> <span class="sh_keyword">true</span><span class="sh_symbol">);</span>
                <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>pos<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> v<span class="sh_symbol">],</span> fgt<span class="sh_symbol">[</span>u<span class="sh_symbol">]);</span>
                <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
            <span class="sh_keyword">case</span> <span class="sh_number">3</span><span class="sh_symbol">:</span>
                <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>pos<span class="sh_symbol">[</span>u<span class="sh_symbol">]],</span> fgt<span class="sh_symbol">[</span>u<span class="sh_symbol">],</span> <span class="sh_keyword">true</span><span class="sh_symbol">);</span>
                <span class="sh_function">adj</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>pos<span class="sh_symbol">[</span>u<span class="sh_symbol">]],</span> fgt<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> v<span class="sh_symbol">);</span>
                <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

</code></pre></div>

<h2>坑</h2>
<p>这题的坑又到了让我无发可说的境界……</p>
<p><b>坑1：</b>由于这道题的输入输出量都<s>很大</s>，所以(bu)<s>强</s>(zen)<s>烈</s>(me)建议大家写 IO 优化。</p>
<p><b>坑2：</b>然后就莫名的 TLE 掉了！本来用的是 STL 的 <code>merge()</code>，改成手写的 <code>Merge()</code> 后还是 TLE 掉！然后开始用 Python 造数据，和 std 拍了半天拍不出来，本机跑跑啥数据都比 std 快，以为是 IO 优化没写的原因 (好像 std 也没写)，然后写了还是 TLE 掉！</p>
<p>然后我又把代码从头到尾查了一遍，恍然大悟：<b>这不是 TLE！这是死循环！</b>因为我造的数据对于每条边 <i>e<sub>i</sub></i> = (<i>u<sub>i</sub></i>, <i>v<sub>i</sub></i>) 满足<b>在以 1 号点为根的树中 <i>u<sub>i</sub></i> 为 <i>v<sub>i</sub></i> 的父节点</b>！</p>
<p>然而样例也恰恰是这样，然后居然<b>只连了一条单向边</b>！结果造成了本地过的<b>假象</b>，于是我瞎打了个反着的数据，两遍 dfs 直接挂掉 (死循环)！</p>
<p>然后，开了双向边后，就直接 AC 掉了，<s>这回跑得倒真比 std 快……</s></p>
