<link type="text/css" rel="stylesheet" href="../additional_files/css/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/css/sh_typical.min.css">
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$', '$']], displayMath: [['$$', '$$']]}});</script>
<script type="text/javascript" src="../additional_files/MathJax-master/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<h3>题目描述</h3>
<p>有 $n$ 个水杯，在一个雨天后，第 $i$ 个水杯收集到了高度为 $h_i$ 的水，<b>任何两个不同杯子收集到的水的高度互不相同</b>。</p>
<p>每次可以指定任意多的水杯用连通器连通一下，则这些水杯的水在这次操作后会到达同一高度 $\bar h$，并且 $\bar h$ 为这些水杯的水的高度的平均值。</p>
<p><s>由于连通器系统的复杂性</s>，你至多只能操作 $k$ 次 (使用 $k$ 次连通器)，求 $1$ 号水杯的水的高度的最大值。</p>
<p>答案需要输出 $p$ 位小数。</p>

<h3>输入格式</h3>
<p>输入的第一行包含 $3$ 个正整数 $n, k, p$，分别表示水杯的数量，操作次数的上限，输出的答案要求的精度。</p>
<p>接下来一行包含 $n$ 个正整数，描述水杯中水的高度。其中第 $i$ 个正整数 $h_i$ 表示第 $i$ 个水杯中水的高度，<b>保证 $h_i$ 互不相同</b>，$1 \leq h_i \leq 10^5$。</p>

<h3>输出格式</h3>
<p>输出仅一行，包含一个实数，表示 $1$ 号水杯的水的最大高度，绝对误差小于 $10^{-p}$。</p>

<h3>题解</h3>
<p>初看这道题，好像没什么思路，看样子找不到神马 DP 方程，那么从小数据先来吧。</p>
<p>首先尝试一个大法师 (dfs)，发现可以骗来 25 分，然后特判一下 $k = 1$，就能骗 35 分。</p>
<p>接下来讲正解：</p>
<p>先来看一些<s>非常显然的</s>性质 (由于过于显然，可以凭<b>直觉</b>判断，证明略，并且默认为最优方案中)：</p>
<ol>
<li>所有水量不超过 $1$ 号水杯的水量不对答案产生影响，即它们不参与连通。</li>
<li>除 $1$ 号水杯外，每个水杯至多被连通一次，且每次都与 $1$ 号水杯连通。</li>
<li>除 $1$ 号水杯外，每次连通的最小水量大于上一次连通的最大水量。</li>
<li>将 $2 \sim n$ 号水杯的水量从小到大排序后，每次连通均为 $1$ 号杯与连续的一段水杯 (即一个区间)。</li>
<li>任两次相邻的连通中选择的区间是稠密的 (即中间不存在漏掉的水杯)。</li>
</ol>
<p>于是就有以下 DP 模型 (记 $S_i = \sum \limits_{i=1}^n h_i$)，其中 $f_{i,j}$ 表示到达第 $i$ 个水杯，连通 $j$ 次后，$1$ 号水杯的水的最大高度</p>
<p>$$ f_{i,j} = \max_{k &lt; i} \left\{ \frac{f_{k,j-1} + S_i - S_k}{i - k + 1} \right\} $$</p>
<p>显然这是一个 $\Theta(n^2k)$ 的 DP，由于 $k \geq n$ 时可以令 $k \gets n$，所以复杂度为 $\Theta(n^3)$。</p>
<p>然后可以看出，这玩意儿可以斜率优化，于是复杂度变成了 $\Theta(n^2)$ (当然 $p$ 这里省略)。</p>
<p>然而这还能优化 (因为还有条件没用啊)！</p>
<p>由于这些水量互不相同，于是可以发现，<b>每次连通时，长度大于 $1$ 的区间个数至多有 $O(\log nh)$ 个</b>。</p>
<p>所以对 $j$ 只需 DP $O(\log nh)$ 层 (大概是 $14$ 层)，然后暴力计算。</p>
<p>然而由于出题人给的 "定点高精度小数类" <s>实在太菜</s>，所以有两种优化方法：</p>
<ol>
<li>可以用 <code>long double</code> 存储转移，然后再用 <code>Decimal</code> 计算一遍。</li>
<li>手写高精度分数类 <code>HFrac</code>。 (当然也可以两种结合起来，跑的飞起)</li>
</ol>
<p>然后我就写了个分数类，然后全部用 <code>HFrac</code> 计算居然也没 TLE 掉。</p>

<h3>代码</h3>

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">typedef</span> <span class="sh_type">long</span> <span class="sh_type">double</span> ld<span class="sh_symbol">;</span>
<span class="sh_keyword">typedef</span> <span class="sh_type">long</span> <span class="sh_type">long</span> ll<span class="sh_symbol">;</span>

<span class="sh_keyword">const</span> <span class="sh_type">int</span> PREC <span class="sh_symbol">=</span> <span class="sh_number">2400</span><span class="sh_symbol">;</span>

<span class="sh_keyword">class</span><span class="sh_normal"> </span><span class="sh_classname">VeryLong</span><span class="sh_cbracket">{</span> <span class="sh_comment">// high precision natural number</span>
    <span class="sh_keyword">private</span><span class="sh_symbol">:</span>
        <span class="sh_keyword">static</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> len <span class="sh_symbol">=</span> PREC <span class="sh_symbol">/</span> <span class="sh_number">9</span> <span class="sh_symbol">+</span> <span class="sh_number">5</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">static</span> <span class="sh_keyword">const</span> <span class="sh_usertype">ll</span><span class="sh_normal"> </span>BASE <span class="sh_symbol">=</span> 1000000000ll<span class="sh_symbol">;</span>
        <span class="sh_type">int</span> n<span class="sh_symbol">,</span> s<span class="sh_symbol">[</span>len<span class="sh_symbol">];</span>
        <span class="sh_type">void</span> <span class="sh_function">init</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span><span class="sh_function">memset</span><span class="sh_symbol">(</span>s<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> s<span class="sh_symbol">);</span> n <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">void</span> <span class="sh_function">initint</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">init</span><span class="sh_symbol">();</span> s<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> x<span class="sh_symbol">;</span><span class="sh_cbracket">}</span> <span class="sh_comment">// x &lt; 10^9</span>
        <span class="sh_type">void</span> <span class="sh_function">initll</span><span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>x<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">init</span><span class="sh_symbol">();</span> s<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> x <span class="sh_symbol">%</span> BASE<span class="sh_symbol">;</span> s<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> x <span class="sh_symbol">/</span> BASE<span class="sh_symbol">;</span> n <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>s<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">?</span> <span class="sh_number">2</span> <span class="sh_symbol">:</span> <span class="sh_number">1</span><span class="sh_symbol">);</span><span class="sh_cbracket">}</span> <span class="sh_comment">// x &lt; 10^18</span>
        <span class="sh_type">void</span> <span class="sh_function">initstr</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">char</span> <span class="sh_symbol">*</span>s<span class="sh_symbol">);</span>
        <span class="sh_type">void</span> <span class="sh_function">initself</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>n <span class="sh_symbol">=</span> b<span class="sh_symbol">.</span>n<span class="sh_symbol">;</span> <span class="sh_function">memcpy</span><span class="sh_symbol">(</span>s<span class="sh_symbol">,</span> b<span class="sh_symbol">.</span>s<span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> s<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
        <span class="sh_type">void</span> <span class="sh_function">mul2</span><span class="sh_symbol">();</span> <span class="sh_comment">// 2a</span>
        <span class="sh_type">void</span> <span class="sh_function">div2</span><span class="sh_symbol">();</span> <span class="sh_comment">// floor(a / 2)</span>
        <span class="sh_type">int</span> <span class="sh_function">mod2</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> s<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span> <span class="sh_comment">// a % 2</span>
    <span class="sh_keyword">public</span><span class="sh_symbol">:</span>
        <span class="sh_function">VeryLong</span> <span class="sh_symbol">()</span> <span class="sh_cbracket">{</span><span class="sh_function">init</span><span class="sh_symbol">();</span><span class="sh_cbracket">}</span>
        <span class="sh_function">VeryLong</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">initint</span><span class="sh_symbol">(</span>x<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
        <span class="sh_function">VeryLong</span> <span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>x<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">initll</span><span class="sh_symbol">(</span>x<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
        <span class="sh_function">VeryLong</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">char</span> <span class="sh_symbol">*</span>s<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">initstr</span><span class="sh_symbol">(</span>s<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
        <span class="sh_function">VeryLong</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">initself</span><span class="sh_symbol">(</span>b<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
        <span class="sh_type">char</span> <span class="sh_symbol">*</span> <span class="sh_function">tostring</span><span class="sh_symbol">(</span><span class="sh_type">char</span> <span class="sh_symbol">*</span>buf<span class="sh_symbol">);</span>
        VeryLong <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">initint</span><span class="sh_symbol">(</span>x<span class="sh_symbol">);</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        VeryLong <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span><span class="sh_usertype">ll</span><span class="sh_normal"> </span>x<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">initll</span><span class="sh_symbol">(</span>x<span class="sh_symbol">);</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        VeryLong <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">char</span> <span class="sh_symbol">*</span>s<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">initstr</span><span class="sh_symbol">(</span>s<span class="sh_symbol">);</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        VeryLong <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_function">initself</span><span class="sh_symbol">(</span>b<span class="sh_symbol">);</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">int</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">);</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">&lt;</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&gt;</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">&gt;</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">&lt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&gt;=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">&gt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">==</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">==</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">!=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">!=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        VeryLong <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">+=</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">);</span> <span class="sh_comment">// x &lt; 10^9</span>
        VeryLong <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">+=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">);</span>
        VeryLong <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">-=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">);</span> <span class="sh_comment">// you should make sure that a &gt;= b</span>
        VeryLong <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">*=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span> <span class="sh_symbol">=</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span> <span class="sh_symbol">*</span> b<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        VeryLong <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">/=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span> <span class="sh_symbol">=</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span> <span class="sh_symbol">/</span> b<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">+</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_function">ret</span><span class="sh_symbol">(*</span><span class="sh_keyword">this</span><span class="sh_symbol">);</span> ret <span class="sh_symbol">+=</span> b<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">-</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_function">ret</span><span class="sh_symbol">(*</span><span class="sh_keyword">this</span><span class="sh_symbol">);</span> ret <span class="sh_symbol">-=</span> b<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">);</span> <span class="sh_comment">// x &lt; 10^9</span>
        <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">);</span>
        <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">/</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>ret<span class="sh_symbol">;</span> <span class="sh_function">DivMod</span><span class="sh_symbol">(*</span><span class="sh_keyword">this</span><span class="sh_symbol">,</span> b<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>ret<span class="sh_symbol">,</span> NULL<span class="sh_symbol">);</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span><span class="sh_cbracket">}</span> <span class="sh_comment">// you should make sure that a &gt;= b</span>
        <span class="sh_keyword">friend</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_function">DivMod</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>a<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">,</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>quo<span class="sh_symbol">,</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>rem<span class="sh_symbol">);</span>
        <span class="sh_keyword">friend</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_function">GCD</span> <span class="sh_symbol">(</span><span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>a<span class="sh_symbol">,</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>b<span class="sh_symbol">);</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_type">void</span> VeryLong<span class="sh_symbol">::</span><span class="sh_function">initstr</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">char</span> <span class="sh_symbol">*</span>str<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span> <span class="sh_comment">// init with string</span>
    <span class="sh_type">int</span> L <span class="sh_symbol">=</span> <span class="sh_function">strlen</span><span class="sh_symbol">(</span>str<span class="sh_symbol">);</span>
    <span class="sh_type">char</span> tok<span class="sh_symbol">[</span><span class="sh_number">10</span><span class="sh_symbol">];</span>
    <span class="sh_function">init</span><span class="sh_symbol">();</span>
    n <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>L <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">/</span> <span class="sh_number">9</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">*</span> <span class="sh_number">9</span> <span class="sh_symbol">&lt;=</span> L<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">strncpy</span><span class="sh_symbol">(</span>tok<span class="sh_symbol">,</span> str <span class="sh_symbol">+</span> <span class="sh_symbol">(</span>L <span class="sh_symbol">-</span> i <span class="sh_symbol">*</span> <span class="sh_number">9</span><span class="sh_symbol">),</span> <span class="sh_number">9</span><span class="sh_symbol">);</span>
        tok<span class="sh_symbol">[</span><span class="sh_number">9</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_string">'</span><span class="sh_specialchar">\0</span><span class="sh_string">'</span><span class="sh_symbol">;</span>
        s<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">strtol</span><span class="sh_symbol">(</span>tok<span class="sh_symbol">,</span> NULL<span class="sh_symbol">,</span> <span class="sh_number">10</span><span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>L <span class="sh_symbol">%</span> <span class="sh_number">9</span><span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">strncpy</span><span class="sh_symbol">(</span>tok<span class="sh_symbol">,</span> str<span class="sh_symbol">,</span> L <span class="sh_symbol">%</span> <span class="sh_number">9</span><span class="sh_symbol">);</span>
        tok<span class="sh_symbol">[</span>L <span class="sh_symbol">%</span> <span class="sh_number">9</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_string">'</span><span class="sh_specialchar">\0</span><span class="sh_string">'</span><span class="sh_symbol">;</span>
        s<span class="sh_symbol">[</span>n <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">strtol</span><span class="sh_symbol">(</span>tok<span class="sh_symbol">,</span> NULL<span class="sh_symbol">,</span> <span class="sh_number">10</span><span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> VeryLong<span class="sh_symbol">::</span><span class="sh_function">mul2</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span> <span class="sh_comment">// 2a</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;&lt;=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;=</span> BASE<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">-=</span> BASE<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>s<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>n<span class="sh_symbol">])</span> <span class="sh_symbol">++</span>n<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> VeryLong<span class="sh_symbol">::</span><span class="sh_function">div2</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span> <span class="sh_comment">// floor(a / 2)</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> n <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&gt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>i <span class="sh_symbol">&amp;&amp;</span> <span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">))</span> s<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> BASE<span class="sh_symbol">;</span> s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;&gt;=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>s<span class="sh_symbol">[</span>n <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">])</span> <span class="sh_symbol">--</span>n<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">char</span> <span class="sh_symbol">*</span> VeryLong<span class="sh_symbol">::</span><span class="sh_function">tostring</span><span class="sh_symbol">(</span><span class="sh_type">char</span> <span class="sh_symbol">*</span>buf<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span> <span class="sh_comment">// to string</span>
    buf <span class="sh_symbol">+=</span> <span class="sh_function">sprintf</span><span class="sh_symbol">(</span>buf<span class="sh_symbol">,</span> <span class="sh_string">"%d"</span><span class="sh_symbol">,</span> s<span class="sh_symbol">[</span>n <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> n <span class="sh_symbol">-</span> <span class="sh_number">2</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&gt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span>
        buf <span class="sh_symbol">+=</span> <span class="sh_function">sprintf</span><span class="sh_symbol">(</span>buf<span class="sh_symbol">,</span> <span class="sh_string">"%09d"</span><span class="sh_symbol">,</span> s<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
    <span class="sh_keyword">return</span> buf<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> VeryLong<span class="sh_symbol">::</span><span class="sh_function">compare</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span> <span class="sh_comment">// compare (-1, 0, 1)</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>n <span class="sh_symbol">!=</span> b<span class="sh_symbol">.</span>n<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> n <span class="sh_symbol">&lt;</span> b<span class="sh_symbol">.</span>n <span class="sh_symbol">?</span> <span class="sh_symbol">-</span><span class="sh_number">1</span> <span class="sh_symbol">:</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> n <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&gt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i<span class="sh_symbol">--)</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">!=</span> b<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span> <span class="sh_keyword">return</span> s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;</span> b<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">?</span> <span class="sh_symbol">-</span><span class="sh_number">1</span> <span class="sh_symbol">:</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

VeryLong <span class="sh_symbol">&amp;</span> VeryLong<span class="sh_symbol">::</span><span class="sh_keyword">operator</span> <span class="sh_symbol">+=</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    s<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> x<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;=</span> BASE<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>s<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">/</span> BASE<span class="sh_symbol">;</span> s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">%=</span> BASE<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>n<span class="sh_symbol">])</span> <span class="sh_symbol">++</span>n<span class="sh_symbol">;</span>
    <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

VeryLong <span class="sh_symbol">&amp;</span> VeryLong<span class="sh_symbol">::</span><span class="sh_keyword">operator</span> <span class="sh_symbol">+=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    n <span class="sh_symbol">&lt;</span> b<span class="sh_symbol">.</span>n <span class="sh_symbol">?</span> n <span class="sh_symbol">=</span> b<span class="sh_symbol">.</span>n <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> b<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">];</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;=</span> BASE<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">-=</span> BASE<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>s<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span><span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>n<span class="sh_symbol">])</span> <span class="sh_symbol">++</span>n<span class="sh_symbol">;</span>
    <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

VeryLong <span class="sh_symbol">&amp;</span> VeryLong<span class="sh_symbol">::</span><span class="sh_keyword">operator</span> <span class="sh_symbol">-=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">-=</span> b<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">];</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;</span> <span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> BASE<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>s<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">];</span><span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> n <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span> <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
    n <span class="sh_symbol">=</span> i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>VeryLong<span class="sh_symbol">::</span><span class="sh_keyword">operator</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>ret<span class="sh_symbol">;</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
    <span class="sh_usertype">ll</span><span class="sh_normal"> </span>T<span class="sh_symbol">;</span>
    ret<span class="sh_symbol">.</span>n <span class="sh_symbol">=</span> n<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        T <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>ll<span class="sh_symbol">)</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span>ll<span class="sh_symbol">)</span>x<span class="sh_symbol">;</span>
        ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> T <span class="sh_symbol">%</span> BASE<span class="sh_symbol">;</span>
        ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> T <span class="sh_symbol">/</span> BASE<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> ret<span class="sh_symbol">.</span>n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;=</span> BASE<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">/</span> BASE<span class="sh_symbol">;</span> ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">%=</span> BASE<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>ret<span class="sh_symbol">.</span>n<span class="sh_symbol">])</span> <span class="sh_symbol">++</span>ret<span class="sh_symbol">.</span>n<span class="sh_symbol">;</span>
    <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>VeryLong<span class="sh_symbol">::</span><span class="sh_keyword">operator</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>ret<span class="sh_symbol">;</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">,</span> k<span class="sh_symbol">;</span>
    <span class="sh_usertype">ll</span><span class="sh_normal"> </span>T<span class="sh_symbol">;</span>
    ret<span class="sh_symbol">.</span>n <span class="sh_symbol">=</span> n <span class="sh_symbol">+</span> b<span class="sh_symbol">.</span>n<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> j <span class="sh_symbol">&lt;</span> b<span class="sh_symbol">.</span>n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>j<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
            T <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>ll<span class="sh_symbol">)</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span>ll<span class="sh_symbol">)</span>b<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>j<span class="sh_symbol">];</span>
            ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>k <span class="sh_symbol">=</span> i <span class="sh_symbol">+</span> j<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> T <span class="sh_symbol">%</span> BASE<span class="sh_symbol">;</span>
            ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>k <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> T <span class="sh_symbol">/</span> BASE <span class="sh_symbol">%</span> BASE<span class="sh_symbol">;</span>
            ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>k <span class="sh_symbol">+</span> <span class="sh_number">2</span><span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> T <span class="sh_symbol">/</span> <span class="sh_symbol">(</span>BASE <span class="sh_symbol">*</span> BASE<span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> ret<span class="sh_symbol">.</span>n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;=</span> BASE<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">/</span> BASE<span class="sh_symbol">;</span> ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">%=</span> BASE<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>ret<span class="sh_symbol">.</span>s<span class="sh_symbol">[</span>ret<span class="sh_symbol">.</span>n <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">])</span> <span class="sh_symbol">--</span>ret<span class="sh_symbol">.</span>n<span class="sh_symbol">;</span>
    <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_function">DivMod</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>a<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">,</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>quo<span class="sh_symbol">,</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>rem<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">;</span>
    <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_function">ori</span><span class="sh_symbol">(</span>a<span class="sh_symbol">),</span> <span class="sh_function">div</span><span class="sh_symbol">(</span>b<span class="sh_symbol">),</span> ret<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> ori <span class="sh_symbol">&gt;=</span> div<span class="sh_symbol">;</span> div<span class="sh_symbol">.</span><span class="sh_function">mul2</span><span class="sh_symbol">(),</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> i<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>i<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        div<span class="sh_symbol">.</span><span class="sh_function">div2</span><span class="sh_symbol">();</span>
        ret<span class="sh_symbol">.</span><span class="sh_function">mul2</span><span class="sh_symbol">();</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ori <span class="sh_symbol">&gt;=</span> div<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>ret <span class="sh_symbol">+=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> ori <span class="sh_symbol">-=</span> div<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>quo <span class="sh_symbol">!=</span> NULL<span class="sh_symbol">)</span> <span class="sh_symbol">*</span>quo <span class="sh_symbol">=</span> ret<span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>rem <span class="sh_symbol">!=</span> NULL<span class="sh_symbol">)</span> <span class="sh_symbol">*</span>rem <span class="sh_symbol">=</span> ori<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_function">GCD</span> <span class="sh_symbol">(</span><span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>a<span class="sh_symbol">,</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>ret<span class="sh_symbol">;</span>
    <span class="sh_type">int</span> two<span class="sh_symbol">,</span> r<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>two <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_symbol">!(</span>a<span class="sh_symbol">.</span><span class="sh_function">mod2</span><span class="sh_symbol">()</span> <span class="sh_symbol">||</span> b<span class="sh_symbol">.</span><span class="sh_function">mod2</span><span class="sh_symbol">());</span> <span class="sh_symbol">++</span>two<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        a<span class="sh_symbol">.</span><span class="sh_function">div2</span><span class="sh_symbol">();</span> b<span class="sh_symbol">.</span><span class="sh_function">div2</span><span class="sh_symbol">();</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(;;)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">while</span><span class="sh_symbol">(!</span>a<span class="sh_symbol">.</span><span class="sh_function">mod2</span><span class="sh_symbol">())</span> a<span class="sh_symbol">.</span><span class="sh_function">div2</span><span class="sh_symbol">();</span>
        <span class="sh_keyword">while</span><span class="sh_symbol">(!</span>b<span class="sh_symbol">.</span><span class="sh_function">mod2</span><span class="sh_symbol">())</span> b<span class="sh_symbol">.</span><span class="sh_function">div2</span><span class="sh_symbol">();</span>
        r <span class="sh_symbol">=</span> a<span class="sh_symbol">.</span><span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">);</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>r<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>ret <span class="sh_symbol">=</span> a<span class="sh_symbol">;</span> <span class="sh_keyword">break</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        r <span class="sh_symbol">==</span> <span class="sh_number">1</span> <span class="sh_symbol">?</span> a <span class="sh_symbol">-=</span> b <span class="sh_symbol">:</span> b <span class="sh_symbol">-=</span> a<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> two<span class="sh_symbol">;</span> <span class="sh_symbol">--</span>two<span class="sh_symbol">)</span> ret<span class="sh_symbol">.</span><span class="sh_function">mul2</span><span class="sh_symbol">();</span>
    <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_keyword">class</span><span class="sh_normal"> </span><span class="sh_classname">HFrac</span> <span class="sh_cbracket">{</span> <span class="sh_comment">// high precision fraction</span>
    <span class="sh_keyword">private</span><span class="sh_symbol">:</span>
        HFrac <span class="sh_symbol">&amp;</span> <span class="sh_function">Canonicity</span><span class="sh_symbol">();</span>
    <span class="sh_keyword">public</span><span class="sh_symbol">:</span>
        <span class="sh_type">short</span> sign<span class="sh_symbol">;</span>
        <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>nume<span class="sh_symbol">,</span> deno<span class="sh_symbol">;</span>
        <span class="sh_function">HFrac</span> <span class="sh_symbol">():</span> <span class="sh_function">sign</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">),</span> <span class="sh_function">deno</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
        <span class="sh_function">HFrac</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>value<span class="sh_symbol">):</span> <span class="sh_function">sign</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">),</span> <span class="sh_function">nume</span><span class="sh_symbol">(</span>value<span class="sh_symbol">),</span> <span class="sh_function">deno</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
        <span class="sh_function">HFrac</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>numerator<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>denominator<span class="sh_symbol">):</span> <span class="sh_function">sign</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">),</span> <span class="sh_function">nume</span><span class="sh_symbol">(</span>numerator<span class="sh_symbol">),</span> <span class="sh_function">deno</span><span class="sh_symbol">(</span>denominator<span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
        <span class="sh_function">HFrac</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">):</span> <span class="sh_function">sign</span><span class="sh_symbol">(</span>b<span class="sh_symbol">.</span>sign<span class="sh_symbol">),</span> <span class="sh_function">nume</span><span class="sh_symbol">(</span>b<span class="sh_symbol">.</span>nume<span class="sh_symbol">),</span> <span class="sh_function">deno</span><span class="sh_symbol">(</span>b<span class="sh_symbol">.</span>deno<span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
        HFrac <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>sign <span class="sh_symbol">=</span> b<span class="sh_symbol">.</span>sign<span class="sh_symbol">;</span> nume <span class="sh_symbol">=</span> b<span class="sh_symbol">.</span>nume<span class="sh_symbol">;</span> deno <span class="sh_symbol">=</span> b<span class="sh_symbol">.</span>deno<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">char</span> <span class="sh_symbol">*</span> <span class="sh_function">tostring</span><span class="sh_symbol">(</span><span class="sh_type">char</span> <span class="sh_symbol">*</span>buf<span class="sh_symbol">,</span> <span class="sh_type">int</span> prec<span class="sh_symbol">);</span>
        <span class="sh_type">int</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">);</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">&lt;</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&gt;</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">&gt;</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">&lt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&gt;=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">&gt;=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">==</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">==</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">!=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">compare</span><span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_symbol">!=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_keyword">friend</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">-</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_function">ret</span><span class="sh_symbol">(</span>b<span class="sh_symbol">);</span> ret<span class="sh_symbol">.</span>sign <span class="sh_symbol">=</span> <span class="sh_symbol">-</span>ret<span class="sh_symbol">.</span>sign<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        HFrac <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">+=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span> <span class="sh_symbol">=</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span> <span class="sh_symbol">+</span> b<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        HFrac <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">-=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span> <span class="sh_symbol">=</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span> <span class="sh_symbol">-</span> b<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        HFrac <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">*=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">);</span>
        HFrac <span class="sh_symbol">&amp;</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">/=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">);</span>
        <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">+</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">);</span>
        <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">-</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_function">ret</span><span class="sh_symbol">(*</span><span class="sh_keyword">this</span><span class="sh_symbol">);</span> ret <span class="sh_symbol">+=</span> <span class="sh_symbol">-</span>b<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_function">ret</span><span class="sh_symbol">(*</span><span class="sh_keyword">this</span><span class="sh_symbol">);</span> ret <span class="sh_symbol">*=</span> b<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
        <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_keyword">operator</span> <span class="sh_symbol">/</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_function">ret</span><span class="sh_symbol">(*</span><span class="sh_keyword">this</span><span class="sh_symbol">);</span> ret <span class="sh_symbol">/=</span> b<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span><span class="sh_cbracket">}</span> <span class="sh_comment">// a / 0 = 0</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

HFrac <span class="sh_symbol">&amp;</span> HFrac<span class="sh_symbol">::</span><span class="sh_function">Canonicity</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span> <span class="sh_comment">// reduction</span>
<span class="sh_comment">//    if(!sign) return *this;</span>
<span class="sh_comment">//    VeryLong d = GCD(nume, deno);</span>
<span class="sh_comment">//    nume /= d; deno /= d;</span>
    <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">char</span> <span class="sh_symbol">*</span> HFrac<span class="sh_symbol">::</span><span class="sh_function">tostring</span><span class="sh_symbol">(</span><span class="sh_type">char</span> <span class="sh_symbol">*</span>buf<span class="sh_symbol">,</span> <span class="sh_type">int</span> prec<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>sign<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        buf <span class="sh_symbol">+=</span> <span class="sh_function">sprintf</span><span class="sh_symbol">(</span>buf<span class="sh_symbol">,</span> <span class="sh_string">"0."</span><span class="sh_symbol">);</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> prec<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> <span class="sh_symbol">*</span>buf<span class="sh_symbol">++</span> <span class="sh_symbol">=</span> <span class="sh_string">'0'</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>sign <span class="sh_symbol">==</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">*</span>buf<span class="sh_symbol">++</span> <span class="sh_symbol">=</span> <span class="sh_string">'-'</span><span class="sh_symbol">;</span>
        <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span>Q<span class="sh_symbol">,</span> y1<span class="sh_symbol">,</span> y2<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>z1 <span class="sh_symbol">=</span> <span class="sh_symbol">&amp;</span>y1<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>z2 <span class="sh_symbol">=</span> <span class="sh_symbol">&amp;</span>y2<span class="sh_symbol">;</span>
        <span class="sh_function">DivMod</span><span class="sh_symbol">(</span>nume<span class="sh_symbol">,</span> deno<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>Q<span class="sh_symbol">,</span> z1<span class="sh_symbol">);</span>
        buf <span class="sh_symbol">=</span> Q<span class="sh_symbol">.</span><span class="sh_function">tostring</span><span class="sh_symbol">(</span>buf<span class="sh_symbol">);</span>
        <span class="sh_symbol">*</span>buf<span class="sh_symbol">++</span> <span class="sh_symbol">=</span> <span class="sh_string">'.'</span><span class="sh_symbol">;</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span><span class="sh_type">int</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> prec<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
            <span class="sh_symbol">*</span>z1 <span class="sh_symbol">*=</span> <span class="sh_number">10</span><span class="sh_symbol">;</span>
            <span class="sh_function">DivMod</span><span class="sh_symbol">(*</span>z1<span class="sh_symbol">,</span> deno<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>Q<span class="sh_symbol">,</span> z2<span class="sh_symbol">);</span>
            buf <span class="sh_symbol">=</span> Q<span class="sh_symbol">.</span><span class="sh_function">tostring</span><span class="sh_symbol">(</span>buf<span class="sh_symbol">);</span>
            <span class="sh_function">swap</span><span class="sh_symbol">(</span>z1<span class="sh_symbol">,</span> z2<span class="sh_symbol">);</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">return</span> buf<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> HFrac<span class="sh_symbol">::</span><span class="sh_function">compare</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>sign <span class="sh_symbol">!=</span> b<span class="sh_symbol">.</span>sign<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> sign <span class="sh_symbol">&lt;</span> b<span class="sh_symbol">.</span>sign <span class="sh_symbol">?</span> <span class="sh_symbol">-</span><span class="sh_number">1</span> <span class="sh_symbol">:</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>sign<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_usertype">VeryLong</span><span class="sh_normal"> </span><span class="sh_function">x1y2</span><span class="sh_symbol">(</span>nume <span class="sh_symbol">*</span> b<span class="sh_symbol">.</span>deno<span class="sh_symbol">),</span> <span class="sh_function">x2y1</span><span class="sh_symbol">(</span>deno <span class="sh_symbol">*</span> b<span class="sh_symbol">.</span>nume<span class="sh_symbol">);</span>
    <span class="sh_type">int</span> l <span class="sh_symbol">=</span> x1y2<span class="sh_symbol">.</span><span class="sh_function">compare</span><span class="sh_symbol">(</span>x2y1<span class="sh_symbol">);</span>
    <span class="sh_keyword">return</span> sign <span class="sh_symbol">==</span> <span class="sh_number">1</span> <span class="sh_symbol">?</span> l <span class="sh_symbol">:</span> <span class="sh_symbol">-</span>l<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_usertype">HFrac</span><span class="sh_normal"> </span>HFrac<span class="sh_symbol">::</span><span class="sh_keyword">operator</span> <span class="sh_symbol">+</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>b<span class="sh_symbol">.</span>sign<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>sign<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> b<span class="sh_symbol">;</span>
    <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span>ret<span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>sign <span class="sh_symbol">==</span> b<span class="sh_symbol">.</span>sign<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        ret<span class="sh_symbol">.</span>sign <span class="sh_symbol">=</span> sign<span class="sh_symbol">;</span>
        ret<span class="sh_symbol">.</span>nume <span class="sh_symbol">=</span> nume <span class="sh_symbol">*</span> b<span class="sh_symbol">.</span>deno <span class="sh_symbol">+</span> deno <span class="sh_symbol">*</span> b<span class="sh_symbol">.</span>nume<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(*</span><span class="sh_keyword">this</span> <span class="sh_symbol">==</span> <span class="sh_symbol">-</span>b<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">;</span>
        ret<span class="sh_symbol">.</span>nume <span class="sh_symbol">=</span> nume <span class="sh_symbol">*</span> b<span class="sh_symbol">.</span>deno<span class="sh_symbol">;</span>
        ret<span class="sh_symbol">.</span>deno <span class="sh_symbol">=</span> deno <span class="sh_symbol">*</span> b<span class="sh_symbol">.</span>nume<span class="sh_symbol">;</span>
        ret<span class="sh_symbol">.</span>sign <span class="sh_symbol">=</span> ret<span class="sh_symbol">.</span>nume<span class="sh_symbol">.</span><span class="sh_function">compare</span><span class="sh_symbol">(</span>ret<span class="sh_symbol">.</span>deno<span class="sh_symbol">);</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ret<span class="sh_symbol">.</span>sign <span class="sh_symbol">==</span> <span class="sh_number">1</span><span class="sh_symbol">)</span>
            ret<span class="sh_symbol">.</span>nume <span class="sh_symbol">=</span> ret<span class="sh_symbol">.</span>nume <span class="sh_symbol">-</span> ret<span class="sh_symbol">.</span>deno<span class="sh_symbol">;</span>
        <span class="sh_keyword">else</span>
            ret<span class="sh_symbol">.</span>nume <span class="sh_symbol">=</span> ret<span class="sh_symbol">.</span>deno <span class="sh_symbol">-</span> ret<span class="sh_symbol">.</span>nume<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    ret<span class="sh_symbol">.</span>deno <span class="sh_symbol">=</span> deno <span class="sh_symbol">*</span> b<span class="sh_symbol">.</span>deno<span class="sh_symbol">;</span>
    <span class="sh_keyword">return</span> ret<span class="sh_symbol">.</span><span class="sh_function">Canonicity</span><span class="sh_symbol">();</span>
<span class="sh_cbracket">}</span>

HFrac <span class="sh_symbol">&amp;</span> HFrac<span class="sh_symbol">::</span><span class="sh_keyword">operator</span> <span class="sh_symbol">*=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>b<span class="sh_symbol">.</span>sign<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>sign <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> nume <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> deno <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>sign<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
    b<span class="sh_symbol">.</span>sign <span class="sh_symbol">==</span> <span class="sh_symbol">-</span><span class="sh_number">1</span> <span class="sh_symbol">?</span> sign <span class="sh_symbol">=</span> <span class="sh_symbol">-</span>sign <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    nume <span class="sh_symbol">*=</span> b<span class="sh_symbol">.</span>nume<span class="sh_symbol">;</span> deno <span class="sh_symbol">*=</span> b<span class="sh_symbol">.</span>deno<span class="sh_symbol">;</span>
    <span class="sh_function">Canonicity</span><span class="sh_symbol">();</span>
    <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

HFrac <span class="sh_symbol">&amp;</span> HFrac<span class="sh_symbol">::</span><span class="sh_keyword">operator</span> <span class="sh_symbol">/=</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>b<span class="sh_symbol">.</span>sign<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>sign <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> nume <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> deno <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>sign<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
    b<span class="sh_symbol">.</span>sign <span class="sh_symbol">==</span> <span class="sh_symbol">-</span><span class="sh_number">1</span> <span class="sh_symbol">?</span> sign <span class="sh_symbol">=</span> <span class="sh_symbol">-</span>sign <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    nume <span class="sh_symbol">*=</span> b<span class="sh_symbol">.</span>deno<span class="sh_symbol">;</span> deno <span class="sh_symbol">*=</span> b<span class="sh_symbol">.</span>nume<span class="sh_symbol">;</span>
    <span class="sh_function">Canonicity</span><span class="sh_symbol">();</span>
    <span class="sh_keyword">return</span> <span class="sh_symbol">*</span><span class="sh_keyword">this</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_preproc">#define</span> N <span class="sh_number">8034</span>

<span class="sh_type">int</span> n<span class="sh_symbol">,</span> k<span class="sh_symbol">,</span> p<span class="sh_symbol">;</span>
<span class="sh_type">int</span> M<span class="sh_symbol">,</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">,</span> l<span class="sh_symbol">;</span>
<span class="sh_type">int</span> a<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> s<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>
<span class="sh_type">int</span> h<span class="sh_symbol">,</span> t<span class="sh_symbol">,</span> que<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>
<span class="sh_usertype">HFrac</span><span class="sh_normal"> </span>f<span class="sh_symbol">[</span>N<span class="sh_symbol">][</span><span class="sh_number">2</span><span class="sh_symbol">],</span> x<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> y<span class="sh_symbol">[</span>N<span class="sh_symbol">],</span> ans<span class="sh_symbol">;</span>
<span class="sh_type">char</span> buffer<span class="sh_symbol">[</span>N<span class="sh_symbol">];</span>

<span class="sh_keyword">inline</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_function">slope</span><span class="sh_symbol">(</span><span class="sh_type">int</span> pi<span class="sh_symbol">,</span> <span class="sh_type">int</span> pj<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_symbol">(</span>y<span class="sh_symbol">[</span>pj<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> y<span class="sh_symbol">[</span>pi<span class="sh_symbol">])</span> <span class="sh_symbol">/</span> <span class="sh_symbol">(</span>x<span class="sh_symbol">[</span>pj<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> x<span class="sh_symbol">[</span>pi<span class="sh_symbol">]);</span><span class="sh_cbracket">}</span>

<span class="sh_keyword">inline</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span><span class="sh_function">slope</span><span class="sh_symbol">(</span><span class="sh_type">int</span> p<span class="sh_symbol">,</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span>X<span class="sh_symbol">,</span> <span class="sh_usertype">HFrac</span><span class="sh_normal"> </span>Y<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_symbol">(</span>Y <span class="sh_symbol">-</span> y<span class="sh_symbol">[</span>p<span class="sh_symbol">])</span> <span class="sh_symbol">/</span> <span class="sh_symbol">(</span>X <span class="sh_symbol">-</span> x<span class="sh_symbol">[</span>p<span class="sh_symbol">]);</span><span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>k<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>p<span class="sh_symbol">,</span> a<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d"</span><span class="sh_symbol">,</span> a <span class="sh_symbol">+</span> i<span class="sh_symbol">);</span>
        a<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;=</span> a<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">?</span> <span class="sh_symbol">--</span>n <span class="sh_symbol">:</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_function">sort</span><span class="sh_symbol">(</span>a <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> a <span class="sh_symbol">+</span> n<span class="sh_symbol">);</span> s<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> s<span class="sh_symbol">[</span>i <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">+</span> a<span class="sh_symbol">[</span>i<span class="sh_symbol">];</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> f<span class="sh_symbol">[</span>i<span class="sh_symbol">][</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>a<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]);</span>
    k <span class="sh_symbol">&gt;</span> n <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">?</span> k <span class="sh_symbol">=</span> n <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
    M <span class="sh_symbol">=</span> <span class="sh_function">min</span><span class="sh_symbol">(</span>k<span class="sh_symbol">,</span> <span class="sh_number">14</span><span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> j <span class="sh_symbol">&lt;=</span> M<span class="sh_symbol">;</span> j<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
        f<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">][</span>j <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>a<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]);</span>
        h <span class="sh_symbol">=</span> t <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        que<span class="sh_symbol">[</span>t<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
        x<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">HFrac</span><span class="sh_symbol">();</span> y<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">-</span>f<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">][</span>j <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span> <span class="sh_symbol">^</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> h <span class="sh_symbol">+</span> <span class="sh_number">1</span> <span class="sh_symbol">&lt;</span> t <span class="sh_symbol">&amp;&amp;</span> <span class="sh_function">slope</span><span class="sh_symbol">(</span>que<span class="sh_symbol">[</span>h<span class="sh_symbol">],</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">),</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]))</span> <span class="sh_symbol">&lt;</span> <span class="sh_function">slope</span><span class="sh_symbol">(</span>que<span class="sh_symbol">[</span>h <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">],</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>i <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">),</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]));</span> <span class="sh_symbol">++</span>h<span class="sh_symbol">);</span>
            x<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>i<span class="sh_symbol">);</span>
            y<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span> <span class="sh_symbol">-</span> f<span class="sh_symbol">[</span>i<span class="sh_symbol">][</span>j <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span> <span class="sh_symbol">^</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
            l <span class="sh_symbol">=</span> que<span class="sh_symbol">[</span>h<span class="sh_symbol">];</span>
            f<span class="sh_symbol">[</span>i<span class="sh_symbol">][</span>j <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>s<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">-</span> s<span class="sh_symbol">[</span>l<span class="sh_symbol">])</span> <span class="sh_symbol">+</span> f<span class="sh_symbol">[</span>l<span class="sh_symbol">][</span>j <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span> <span class="sh_symbol">^</span> <span class="sh_number">1</span><span class="sh_symbol">];</span>
            f<span class="sh_symbol">[</span>i<span class="sh_symbol">][</span>j <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">/=</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>i <span class="sh_symbol">-</span> l <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
            <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> h <span class="sh_symbol">+</span> <span class="sh_number">1</span> <span class="sh_symbol">&lt;</span> t <span class="sh_symbol">&amp;&amp;</span> <span class="sh_function">slope</span><span class="sh_symbol">(</span>i<span class="sh_symbol">,</span> que<span class="sh_symbol">[</span>t <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">])</span> <span class="sh_symbol">&lt;=</span> <span class="sh_function">slope</span><span class="sh_symbol">(</span>que<span class="sh_symbol">[</span>t <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">],</span> que<span class="sh_symbol">[</span>t <span class="sh_symbol">-</span> <span class="sh_number">2</span><span class="sh_symbol">]);</span> <span class="sh_symbol">--</span>t<span class="sh_symbol">);</span>
            que<span class="sh_symbol">[</span>t<span class="sh_symbol">++]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
    l <span class="sh_symbol">=</span> k <span class="sh_symbol">-</span> M<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> j <span class="sh_symbol">&lt;=</span> M<span class="sh_symbol">;</span> j<span class="sh_symbol">++)</span> f<span class="sh_symbol">[</span>n <span class="sh_symbol">-</span> l <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">][</span>j <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">&gt;</span> ans <span class="sh_symbol">?</span> ans <span class="sh_symbol">=</span> f<span class="sh_symbol">[</span>n <span class="sh_symbol">-</span> l <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">][</span>j <span class="sh_symbol">&amp;</span> <span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">:</span> ans<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> n <span class="sh_symbol">-</span> l<span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> n<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>i<span class="sh_symbol">)</span> ans <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>ans <span class="sh_symbol">+</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span>a<span class="sh_symbol">[</span>i<span class="sh_symbol">]))</span> <span class="sh_symbol">/</span> <span class="sh_function">HFrac</span><span class="sh_symbol">(</span><span class="sh_number">2</span><span class="sh_symbol">);</span>
    ans<span class="sh_symbol">.</span><span class="sh_function">tostring</span><span class="sh_symbol">(</span>buffer<span class="sh_symbol">,</span> p <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
    <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%s</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> buffer<span class="sh_symbol">);</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

</code></pre></div>

<h3>坑</h3>
<p>然鹅花了一上午写了 <code>VeryLong</code> 类和 <code>HFrac</code> 类……</p>
<p><b>坑1：</b>由于其实只需要 DP 大约 $14$ 层，所以最后的 $k-14$ 层一定是长度为 $1$ 的区间，所以在计算的时候<b>只取  $f_{n-(k-14),j}$ 的转移</b>，再暴力计算，不要多算了哦！</p>
