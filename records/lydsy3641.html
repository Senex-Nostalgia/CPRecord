<h2>题目描述</h2>
<p>scx 所在的国家一共有 <i>V</i> 个城市，通过 <i>V</i> 条双向道路连接，使得城市之间两两可以到达。第 <i>i</i> 条道路连接了 <i>a<sub>i</sub></i> 与 <i>b<sub>i</sub></i>，其长度为 <i>l<sub>i</sub></i> km。</p>
<p>这些道路分为 <i>n</i> 个等级。第条道路的等级为 <i>x<sub>i</sub></i>。在第 <i>j</i> 级道路上行驶，你的限速是 <i>v<sub>j</sub></i> km/h，并且每行驶 1 小时会收取 <i>w<sub>j</sub></i> 元的费用。</p>
<p>根据道路分级的意义，<i>v<sub>j</sub></i> 与 <i>w<sub>j</sub></i> 都随着 <i>j</i> 单调变化，即对于 1 ≤ <i>j</i> &lt; <i>n</i>，满足 <i>v<sub>j</sub></i> &gt; <i>v</i><sub><i>j</i> + 1</sub>, <i>w<sub>j</sub></i> &gt; <i>w</i><sub><i>j</i> + 1</sub>。</p>
<p>现在有 <i>q</i> 辆货车需要运送货物。第 <i>k</i> 辆货车要从 <i>s<sub>k</sub></i> 前往 <i>t<sub>k</sub></i>，并且其最大速度为 <i>u<sub>k</sub></i> km/h。你需要对每辆货车求出其最小运送花费。</p>

<h2>输入格式</h2>
<p>第一行包含三个整数 <i>V</i>, <i>n</i>, <i>q</i>。</p>
<p>接下来的 <i>V</i> 行，每行四个整数 <i>a<sub>i</sub></i>, <i>b<sub>i</sub></i>, <i>l<sub>i</sub></i>, <i>x<sub>i</sub></i>，描述一条道路。</p>
<p>接下来的 <i>n</i> 行，每行两个整数 <i>v<sub>j</sub></i>, <i>w<sub>j</sub></i>，描述了一个道路等级的限速和费用。</p>
<p>接下来的 <i>q</i> 行，每行三个整数 <i>s<sub>k</sub></i>, <i>t<sub>k</sub></i>, <i>u<sub>k</sub></i>，描述了一辆货车。</p>

<h2>输出格式</h2>
<p>输出 <i>q</i> 行，即每辆货车的最小运送花费。</p>
<p>你可以输出任意多位的实数，只要与标准答案的相对或绝对误差不超过 10<sup>-4</sup> 就算正确。</p>

<h2>题解</h2>
<p>第一次遇到基环树呵~</p>
<p>假如说只有 <i>V</i> - 1 条无向边，那么就形成了一棵树。</p>
<p>因为原题的变量比较多，所以可以经过复(jian)杂(dan)的计算，就可以得到：一辆速度为 <i>u</i> 的货车通过一条长度为 <i>l</i>，费用为 <i>w</i>，速度为 <i>v</i> 的道路，所需时间为 <img src="http://latex.codecogs.com/gif.latex?\frac{lw}{\min\{u,v\}}">。</p>
<p>于是可以把 <i>q</i> 辆货车离线，按照它们的速度 {<i>u<sub>i</sub></i>} 排序，然后，<i>n</i> 条边依次从 "<b>快边</b>" 变成了 "<b>慢边</b>"，每条边至多变一次。(其中快(慢)边指限速比实际速度大(小)的边)</p>
<p>显然 HLD (树链剖分) 后用两个树状数组 (线段树) 维护<b>区间快边权值和</b>和<b>区间慢边权值和</b>，"<b>快边</b>" 权值存储 <img src="http://latex.codecogs.com/gif.latex?lw">，<code>solve()</code> 的时候直接除以货车的速度 <i>u</i> 就得到了费用，"<b>慢边</b>" 权值存储 <img src="http://latex.codecogs.com/gif.latex?\frac{lw}v">，就是费用。</p>
<p>最后将 "<b>快边</b>" 计算得到的费用和 "<b>慢边</b>" 的费用相加即得总费用。</p>
<p>(scx: 可是原图是基环树啊，可能会有多种方案的！)</p>
<p>其实这有两种方法解决。一种比较经(ben)典(zhuo)的方法就是将环上的所有边用一棵线段树维护，将它们删去后，就形成了若干棵独立的树 (树的个数就是环的阶数)，然后分别 HLD，然而这可能<s>比较慢</s>，代码<s>至少要写 160 ~ 170 行</s>。</p>
<p>其实还有一种方法，就是随便把环上一条边 <i>e</i> 删掉，然后就形成了一棵树，在这棵主树上 HLD，就得到了不包含 <i>e</i> 的第一种方案的总费用。</p>
<p>(scx: 那如果最优的方案包含边 <i>e</i> 呢？)</p>
<p><s>其实这很简单</s>，由于它包含了边 <i>e</i> = (<i>u</i>, <i>v</i>)，所以我们可以计算从起点到 <i>u</i> 的费用，<i>v</i> 到终点的费用，再加上通过 <i>e</i> 的费用，就得到了第二种方案的总费用。</p>
<p>当然，我们不知道起点和 <i>u</i>，<i>v</i> 哪个近，所以再计算从起点到 <i>v</i> 的费用，<i>u</i> 到终点的费用，再加上通过 <i>e</i> 的费用，就得到了第三种方案的总费用。</p>
<p>三种方案的总费用取最小值就是答案了，时间复杂度大概是 <img src="http://latex.codecogs.com/gif.latex?O\left((q+n)\log%20n\right)"> 这个样子。</p>

<h2>代码</h2>

<link type="text/css" rel="stylesheet" href="../additional_files/css/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="../additional_files/css/sh_typical.min.css">

<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_preproc">#include</span> <span class="sh_string">&lt;bits/stdc++.h&gt;</span>
<span class="sh_preproc">#define</span> maxV <span class="sh_number">100034</span>
<span class="sh_preproc">#define</span> maxE <span class="sh_number">256101</span>
<span class="sh_preproc">#define</span> maxN <span class="sh_number">100034</span>
<span class="sh_preproc">#define</span> maxQ <span class="sh_number">100034</span>
<span class="sh_preproc">#define</span> <span class="sh_function">ad</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_symbol">((</span>x <span class="sh_symbol">-</span> <span class="sh_number">1</span> <span class="sh_symbol">^</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">)</span>
<span class="sh_preproc">#define</span> <span class="sh_function">lowbit</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_symbol">(</span>x <span class="sh_symbol">&amp;</span> <span class="sh_symbol">-</span>x<span class="sh_symbol">)</span>
<span class="sh_keyword">using</span> <span class="sh_keyword">namespace</span> std<span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">BIT</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> sz<span class="sh_symbol">;</span> <span class="sh_type">double</span> <span class="sh_symbol">*</span>x<span class="sh_symbol">;</span>
    <span class="sh_function">BIT</span> <span class="sh_symbol">():</span> <span class="sh_function">sz</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>x <span class="sh_symbol">=</span> NULL<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_symbol">~</span><span class="sh_function">BIT</span> <span class="sh_symbol">()</span><span class="sh_cbracket">{</span><span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_keyword">delete</span> <span class="sh_symbol">[]</span> <span class="sh_symbol">(</span>x<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">resize</span><span class="sh_symbol">(</span><span class="sh_type">int</span> size<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>sz <span class="sh_symbol">=</span> size<span class="sh_symbol">;</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>x<span class="sh_symbol">)</span> <span class="sh_keyword">delete</span> <span class="sh_symbol">[]</span> <span class="sh_symbol">(</span>x<span class="sh_symbol">);</span> x <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_type">double</span><span class="sh_symbol">[</span>sz <span class="sh_symbol">+</span> <span class="sh_number">5</span><span class="sh_symbol">];</span> <span class="sh_function">memset</span><span class="sh_symbol">(</span>x<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> sz <span class="sh_symbol">+</span> <span class="sh_number">5</span> <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">3</span><span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">double</span> <span class="sh_function">sum</span><span class="sh_symbol">(</span><span class="sh_type">int</span> h<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">if</span><span class="sh_symbol">(</span>h <span class="sh_symbol">&lt;=</span> <span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_number">0.0</span><span class="sh_symbol">;</span> <span class="sh_type">double</span> s <span class="sh_symbol">=</span> <span class="sh_number">0.0</span><span class="sh_symbol">;</span> <span class="sh_keyword">while</span><span class="sh_symbol">(</span>h<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>s <span class="sh_symbol">+=</span> x<span class="sh_symbol">[</span>h<span class="sh_symbol">];</span> h <span class="sh_symbol">-=</span> <span class="sh_function">lowbit</span><span class="sh_symbol">(</span>h<span class="sh_symbol">);</span><span class="sh_cbracket">}</span> <span class="sh_keyword">return</span> s<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_type">double</span> <span class="sh_function">range</span><span class="sh_symbol">(</span><span class="sh_type">int</span> l<span class="sh_symbol">,</span> <span class="sh_type">int</span> r<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">sum</span><span class="sh_symbol">(</span>r<span class="sh_symbol">)</span> <span class="sh_symbol">-</span> <span class="sh_function">sum</span><span class="sh_symbol">(</span>l <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
    <span class="sh_type">void</span> <span class="sh_function">add</span><span class="sh_symbol">(</span><span class="sh_type">int</span> h<span class="sh_symbol">,</span> <span class="sh_type">double</span> v<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">while</span><span class="sh_symbol">(</span>h <span class="sh_symbol">&lt;=</span> sz<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>x<span class="sh_symbol">[</span>h<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> v<span class="sh_symbol">;</span> h <span class="sh_symbol">+=</span> <span class="sh_function">lowbit</span><span class="sh_symbol">(</span>h<span class="sh_symbol">);</span><span class="sh_cbracket">}}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">edge</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> lim<span class="sh_symbol">,</span> _<span class="sh_symbol">;</span> <span class="sh_type">double</span> w<span class="sh_symbol">;</span>
    <span class="sh_type">bool</span> iscycle<span class="sh_symbol">;</span>
    <span class="sh_function">edge</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> u0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> v0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> l0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> li <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">):</span>
        <span class="sh_function">u</span><span class="sh_symbol">(</span>u0<span class="sh_symbol">),</span> <span class="sh_function">v</span><span class="sh_symbol">(</span>v0<span class="sh_symbol">),</span> <span class="sh_function">l</span><span class="sh_symbol">(</span>l0<span class="sh_symbol">),</span> <span class="sh_function">lim</span><span class="sh_symbol">(</span>li<span class="sh_symbol">),</span> <span class="sh_function">_</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">),</span> <span class="sh_function">w</span><span class="sh_symbol">(</span><span class="sh_number">0.0</span><span class="sh_symbol">),</span> <span class="sh_function">iscycle</span><span class="sh_symbol">(</span><span class="sh_keyword">false</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_keyword">struct</span><span class="sh_normal"> </span><span class="sh_classname">request</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> s<span class="sh_symbol">,</span> t<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> id<span class="sh_symbol">;</span>
    <span class="sh_function">request</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> s0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> t0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> v0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_type">int</span> id0 <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">):</span> <span class="sh_function">s</span><span class="sh_symbol">(</span>s0<span class="sh_symbol">),</span> <span class="sh_function">t</span><span class="sh_symbol">(</span>t0<span class="sh_symbol">),</span> <span class="sh_function">v</span><span class="sh_symbol">(</span>v0<span class="sh_symbol">),</span> <span class="sh_function">id</span><span class="sh_symbol">(</span>id0<span class="sh_symbol">)</span> <span class="sh_cbracket">{}</span>
    <span class="sh_usertype">request</span><span class="sh_normal"> </span><span class="sh_symbol">*</span><span class="sh_function">init</span><span class="sh_symbol">(</span><span class="sh_type">int</span> id0<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>s<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>t<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>v<span class="sh_symbol">);</span> id <span class="sh_symbol">=</span> id0<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> <span class="sh_keyword">this</span><span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
    <span class="sh_type">bool</span> <span class="sh_keyword">operator</span> <span class="sh_symbol">&lt;</span> <span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">request</span><span class="sh_normal"> </span><span class="sh_symbol">&amp;</span>b<span class="sh_symbol">)</span> <span class="sh_keyword">const</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> v <span class="sh_symbol">&lt;</span> b<span class="sh_symbol">.</span>v<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

<span class="sh_type">int</span> V<span class="sh_symbol">,</span> E<span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> q<span class="sh_symbol">,</span> i<span class="sh_symbol">,</span> j<span class="sh_symbol">;</span>
<span class="sh_type">int</span> a<span class="sh_symbol">,</span> b<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> x<span class="sh_symbol">;</span>
<span class="sh_comment">// edges</span>
<span class="sh_usertype">edge</span><span class="sh_normal"> </span>e<span class="sh_symbol">[</span>maxE<span class="sh_symbol">];</span>
<span class="sh_type">int</span> first<span class="sh_symbol">[</span>maxV<span class="sh_symbol">],</span> next<span class="sh_symbol">[</span>maxE<span class="sh_symbol">];</span>
<span class="sh_comment">// levels</span>
<span class="sh_type">int</span> velo<span class="sh_symbol">[</span>maxN<span class="sh_symbol">],</span> cost<span class="sh_symbol">[</span>maxN<span class="sh_symbol">];</span>
<span class="sh_comment">// dfs</span>
<span class="sh_type">int</span> sz<span class="sh_symbol">[</span>maxV<span class="sh_symbol">],</span> p<span class="sh_symbol">[</span>maxV<span class="sh_symbol">],</span> dep<span class="sh_symbol">[</span>maxV<span class="sh_symbol">],</span> weg<span class="sh_symbol">[</span>maxV<span class="sh_symbol">];</span> <span class="sh_comment">// weg[]: v -&gt; e, e[]._: e -&gt; v</span>
<span class="sh_type">int</span> cnt <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>maxV<span class="sh_symbol">],</span> top<span class="sh_symbol">[</span>maxV<span class="sh_symbol">];</span>
<span class="sh_comment">// reqests</span>
<span class="sh_usertype">BIT</span><span class="sh_normal"> </span>bitSlow<span class="sh_symbol">,</span> bitFast<span class="sh_symbol">;</span>

<span class="sh_type">int</span> ef<span class="sh_symbol">[</span>maxV<span class="sh_symbol">];</span>
<span class="sh_usertype">request</span><span class="sh_normal"> </span>req<span class="sh_symbol">[</span>maxQ<span class="sh_symbol">];</span>
<span class="sh_type">double</span> F0<span class="sh_symbol">,</span> F1<span class="sh_symbol">,</span> F2<span class="sh_symbol">,</span> F3<span class="sh_symbol">;</span>
<span class="sh_type">double</span> ans<span class="sh_symbol">[</span>maxQ<span class="sh_symbol">];</span>

<span class="sh_keyword">inline</span> <span class="sh_type">void</span> <span class="sh_function">addedge</span><span class="sh_symbol">(</span><span class="sh_type">int</span> u<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">,</span> <span class="sh_type">int</span> l<span class="sh_symbol">,</span> <span class="sh_type">int</span> lim<span class="sh_symbol">,</span> <span class="sh_type">int</span> id<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>e<span class="sh_symbol">[</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">edge</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> lim<span class="sh_symbol">);</span> next<span class="sh_symbol">[</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">];</span> first<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> id<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">bool</span> <span class="sh_function">cmp</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_type">int</span> <span class="sh_symbol">&amp;</span>y<span class="sh_symbol">)</span><span class="sh_cbracket">{</span><span class="sh_keyword">return</span> e<span class="sh_symbol">[</span>x<span class="sh_symbol">].</span>lim <span class="sh_symbol">&lt;</span> e<span class="sh_symbol">[</span>y<span class="sh_symbol">].</span>lim<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>
<span class="sh_keyword">inline</span> <span class="sh_type">double</span> <span class="sh_function">min</span><span class="sh_symbol">(</span><span class="sh_type">double</span> A<span class="sh_symbol">,</span> <span class="sh_type">double</span> B<span class="sh_symbol">,</span> <span class="sh_type">double</span> C<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>A <span class="sh_symbol">&lt;</span> B <span class="sh_symbol">?</span> <span class="sh_number">0.0</span> <span class="sh_symbol">:</span> A <span class="sh_symbol">=</span> B<span class="sh_symbol">;</span> <span class="sh_keyword">return</span> A <span class="sh_symbol">&lt;</span> C <span class="sh_symbol">?</span> A <span class="sh_symbol">:</span> C<span class="sh_symbol">;</span><span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">dfs_weight</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> y<span class="sh_symbol">;</span>
    sz<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">((</span>y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">)</span> <span class="sh_symbol">!=</span> p<span class="sh_symbol">[</span>x<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(~</span>p<span class="sh_symbol">[</span>y<span class="sh_symbol">])</span> <span class="sh_comment">// cycle</span>
                e<span class="sh_symbol">[</span>l <span class="sh_symbol">=</span> i<span class="sh_symbol">].</span>iscycle <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span><span class="sh_function">ad</span><span class="sh_symbol">(</span>i<span class="sh_symbol">)].</span>iscycle <span class="sh_symbol">=</span> <span class="sh_keyword">true</span><span class="sh_symbol">;</span>
            <span class="sh_keyword">else</span><span class="sh_cbracket">{</span>
                p<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> x<span class="sh_symbol">;</span>
                dep<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> dep<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
                e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>_ <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span><span class="sh_function">ad</span><span class="sh_symbol">(</span>i<span class="sh_symbol">)].</span>_ <span class="sh_symbol">=</span> y<span class="sh_symbol">;</span>
                weg<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> i<span class="sh_symbol">;</span>
                <span class="sh_function">dfs_weight</span><span class="sh_symbol">(</span>y<span class="sh_symbol">);</span>
                sz<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">+=</span> sz<span class="sh_symbol">[</span>y<span class="sh_symbol">];</span>
            <span class="sh_cbracket">}</span>
        <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">void</span> <span class="sh_function">dfs_mc</span><span class="sh_symbol">(</span><span class="sh_type">int</span> x<span class="sh_symbol">,</span> <span class="sh_type">int</span> r<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_type">int</span> i<span class="sh_symbol">,</span> y<span class="sh_symbol">,</span> z <span class="sh_symbol">=</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">;</span>
    o<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_symbol">++</span>cnt<span class="sh_symbol">;</span> top<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> r<span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!(</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>iscycle <span class="sh_symbol">||</span> top<span class="sh_symbol">[</span>y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">]))</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(</span>z <span class="sh_symbol">==</span> <span class="sh_symbol">-</span><span class="sh_number">1</span> <span class="sh_symbol">||</span> sz<span class="sh_symbol">[</span>y<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;</span> sz<span class="sh_symbol">[</span>z<span class="sh_symbol">])</span> z <span class="sh_symbol">=</span> y<span class="sh_symbol">;</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>z <span class="sh_symbol">==</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span>
    <span class="sh_function">dfs_mc</span><span class="sh_symbol">(</span>z<span class="sh_symbol">,</span> r<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> first<span class="sh_symbol">[</span>x<span class="sh_symbol">];</span> i<span class="sh_symbol">;</span> i <span class="sh_symbol">=</span> next<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(!(</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>iscycle <span class="sh_symbol">||</span> top<span class="sh_symbol">[</span>y <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">]))</span>
            <span class="sh_function">dfs_mc</span><span class="sh_symbol">(</span>y<span class="sh_symbol">,</span> y<span class="sh_symbol">);</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">double</span> <span class="sh_function">solve</span><span class="sh_symbol">(</span><span class="sh_type">int</span> u<span class="sh_symbol">,</span> <span class="sh_type">int</span> v<span class="sh_symbol">,</span> <span class="sh_type">int</span> velocity<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>u <span class="sh_symbol">==</span> v<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_number">0.0</span><span class="sh_symbol">;</span>
    <span class="sh_type">int</span> x <span class="sh_symbol">=</span> top<span class="sh_symbol">[</span>u<span class="sh_symbol">],</span> y <span class="sh_symbol">=</span> top<span class="sh_symbol">[</span>v<span class="sh_symbol">];</span>
    <span class="sh_type">double</span> ansSlow <span class="sh_symbol">=</span> <span class="sh_number">0.0</span><span class="sh_symbol">,</span> ansFast <span class="sh_symbol">=</span> <span class="sh_number">0.0</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> x <span class="sh_symbol">!=</span> y<span class="sh_symbol">;</span> u <span class="sh_symbol">=</span> p<span class="sh_symbol">[</span>x<span class="sh_symbol">],</span> x <span class="sh_symbol">=</span> top<span class="sh_symbol">[</span>u<span class="sh_symbol">])</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>dep<span class="sh_symbol">[</span>x<span class="sh_symbol">]</span> <span class="sh_symbol">&lt;</span> dep<span class="sh_symbol">[</span>y<span class="sh_symbol">])</span><span class="sh_cbracket">{</span><span class="sh_function">swap</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span> <span class="sh_function">swap</span><span class="sh_symbol">(</span>x<span class="sh_symbol">,</span> y<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>
        ansSlow <span class="sh_symbol">+=</span> bitSlow<span class="sh_symbol">.</span><span class="sh_function">range</span><span class="sh_symbol">(</span>o<span class="sh_symbol">[</span>x<span class="sh_symbol">],</span> o<span class="sh_symbol">[</span>u<span class="sh_symbol">]);</span>
        ansFast <span class="sh_symbol">+=</span> bitFast<span class="sh_symbol">.</span><span class="sh_function">range</span><span class="sh_symbol">(</span>o<span class="sh_symbol">[</span>x<span class="sh_symbol">],</span> o<span class="sh_symbol">[</span>u<span class="sh_symbol">]);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>dep<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">&gt;</span> dep<span class="sh_symbol">[</span>v<span class="sh_symbol">])</span> <span class="sh_function">swap</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">);</span>
    ansSlow <span class="sh_symbol">+=</span> bitSlow<span class="sh_symbol">.</span><span class="sh_function">range</span><span class="sh_symbol">(</span>o<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>v<span class="sh_symbol">]);</span>
    ansFast <span class="sh_symbol">+=</span> bitFast<span class="sh_symbol">.</span><span class="sh_function">range</span><span class="sh_symbol">(</span>o<span class="sh_symbol">[</span>u<span class="sh_symbol">]</span> <span class="sh_symbol">+</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> o<span class="sh_symbol">[</span>v<span class="sh_symbol">]);</span>
    <span class="sh_keyword">return</span> ansSlow <span class="sh_symbol">+</span> ansFast <span class="sh_symbol">/</span> <span class="sh_symbol">(</span><span class="sh_type">double</span><span class="sh_symbol">)</span>velocity<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_type">int</span> <span class="sh_function">main</span><span class="sh_symbol">()</span><span class="sh_cbracket">{</span>
    <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>V<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>n<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>q<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> V<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
        <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d%d%d"</span><span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>a<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>b<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>l<span class="sh_symbol">,</span> <span class="sh_symbol">&amp;</span>x<span class="sh_symbol">);</span>
        <span class="sh_function">addedge</span><span class="sh_symbol">(</span>a<span class="sh_symbol">,</span> b<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> x<span class="sh_symbol">,</span> <span class="sh_symbol">(</span>i <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">)</span> <span class="sh_symbol">-</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
        <span class="sh_function">addedge</span><span class="sh_symbol">(</span>b<span class="sh_symbol">,</span> a<span class="sh_symbol">,</span> l<span class="sh_symbol">,</span> x<span class="sh_symbol">,</span> i <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_comment">// levels</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> n<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span>
        <span class="sh_function">scanf</span><span class="sh_symbol">(</span><span class="sh_string">"%d%d"</span><span class="sh_symbol">,</span> velo <span class="sh_symbol">+</span> i<span class="sh_symbol">,</span> cost <span class="sh_symbol">+</span> i<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>E <span class="sh_symbol">=</span> V <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> E<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
        e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>w <span class="sh_symbol">=</span> <span class="sh_symbol">(</span><span class="sh_type">double</span><span class="sh_symbol">)</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>l <span class="sh_symbol">*</span> cost<span class="sh_symbol">[</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>lim<span class="sh_symbol">];</span>
        e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>lim <span class="sh_symbol">=</span> velo<span class="sh_symbol">[</span>e<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>lim<span class="sh_symbol">];</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_comment">// heavy-light decomposition</span>
    <span class="sh_function">memset</span><span class="sh_symbol">(</span>p<span class="sh_symbol">,</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_keyword">sizeof</span> p<span class="sh_symbol">);</span>
    p<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> <span class="sh_function">dfs_weight</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">);</span> <span class="sh_function">dfs_mc</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
    <span class="sh_comment">// requests</span>
    bitSlow<span class="sh_symbol">.</span><span class="sh_function">resize</span><span class="sh_symbol">(</span>V<span class="sh_symbol">);</span> bitFast<span class="sh_symbol">.</span><span class="sh_function">resize</span><span class="sh_symbol">(</span>V<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> V<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> ef<span class="sh_symbol">[</span>i<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> i <span class="sh_symbol">&lt;&lt;</span> <span class="sh_number">1</span> <span class="sh_symbol">|</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> <span class="sh_function">sort</span><span class="sh_symbol">(</span>ef<span class="sh_symbol">,</span> ef <span class="sh_symbol">+</span> V<span class="sh_symbol">,</span> cmp<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> q<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span><span class="sh_function">init</span><span class="sh_symbol">(</span>i<span class="sh_symbol">);</span> <span class="sh_function">sort</span><span class="sh_symbol">(</span>req<span class="sh_symbol">,</span> req <span class="sh_symbol">+</span> q<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;=</span> V<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span> <span class="sh_keyword">if</span><span class="sh_symbol">(</span>weg<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span> bitFast<span class="sh_symbol">.</span><span class="sh_function">add</span><span class="sh_symbol">(</span>o<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> e<span class="sh_symbol">[</span>weg<span class="sh_symbol">[</span>i<span class="sh_symbol">]].</span>w<span class="sh_symbol">);</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>j <span class="sh_symbol">=</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> q<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span><span class="sh_cbracket">{</span>
        <span class="sh_keyword">for</span><span class="sh_symbol">(;</span> j <span class="sh_symbol">&lt;</span> V <span class="sh_symbol">&amp;&amp;</span> e<span class="sh_symbol">[</span>a <span class="sh_symbol">=</span> ef<span class="sh_symbol">[</span>j<span class="sh_symbol">]].</span>lim <span class="sh_symbol">&lt;=</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">;</span> <span class="sh_symbol">++</span>j<span class="sh_symbol">)</span>
            <span class="sh_keyword">if</span><span class="sh_symbol">(!</span>e<span class="sh_symbol">[</span>a<span class="sh_symbol">].</span>iscycle<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>
                bitSlow<span class="sh_symbol">.</span><span class="sh_function">add</span><span class="sh_symbol">(</span>o<span class="sh_symbol">[</span>e<span class="sh_symbol">[</span>a<span class="sh_symbol">].</span>_<span class="sh_symbol">],</span> e<span class="sh_symbol">[</span>a<span class="sh_symbol">].</span>w <span class="sh_symbol">/</span> <span class="sh_symbol">(</span><span class="sh_type">double</span><span class="sh_symbol">)</span>e<span class="sh_symbol">[</span>a<span class="sh_symbol">].</span>lim<span class="sh_symbol">);</span>
                bitFast<span class="sh_symbol">.</span><span class="sh_function">add</span><span class="sh_symbol">(</span>o<span class="sh_symbol">[</span>e<span class="sh_symbol">[</span>a<span class="sh_symbol">].</span>_<span class="sh_symbol">],</span> <span class="sh_symbol">-</span>e<span class="sh_symbol">[</span>a<span class="sh_symbol">].</span>w<span class="sh_symbol">);</span>
            <span class="sh_cbracket">}</span>
        F0 <span class="sh_symbol">=</span> e<span class="sh_symbol">[</span>l<span class="sh_symbol">].</span>w <span class="sh_symbol">/</span> <span class="sh_symbol">(</span><span class="sh_type">double</span><span class="sh_symbol">)(</span>e<span class="sh_symbol">[</span>l<span class="sh_symbol">].</span>lim <span class="sh_symbol">&lt;=</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v <span class="sh_symbol">?</span> e<span class="sh_symbol">[</span>l<span class="sh_symbol">].</span>lim <span class="sh_symbol">:</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">);</span>
        F1 <span class="sh_symbol">=</span> <span class="sh_function">solve</span><span class="sh_symbol">(</span>req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>s<span class="sh_symbol">,</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>t<span class="sh_symbol">,</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">);</span>
        F2 <span class="sh_symbol">=</span> <span class="sh_function">solve</span><span class="sh_symbol">(</span>req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>s<span class="sh_symbol">,</span> e<span class="sh_symbol">[</span>l<span class="sh_symbol">].</span>u<span class="sh_symbol">,</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_function">solve</span><span class="sh_symbol">(</span>e<span class="sh_symbol">[</span>l<span class="sh_symbol">].</span>v<span class="sh_symbol">,</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>t<span class="sh_symbol">,</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">);</span>
        F3 <span class="sh_symbol">=</span> <span class="sh_function">solve</span><span class="sh_symbol">(</span>req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>s<span class="sh_symbol">,</span> e<span class="sh_symbol">[</span>l<span class="sh_symbol">].</span>v<span class="sh_symbol">,</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_function">solve</span><span class="sh_symbol">(</span>e<span class="sh_symbol">[</span>l<span class="sh_symbol">].</span>u<span class="sh_symbol">,</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>t<span class="sh_symbol">,</span> req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>v<span class="sh_symbol">);</span>
        ans<span class="sh_symbol">[</span>req<span class="sh_symbol">[</span>i<span class="sh_symbol">].</span>id<span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">min</span><span class="sh_symbol">(</span>F1<span class="sh_symbol">,</span> F0 <span class="sh_symbol">+</span> F2<span class="sh_symbol">,</span> F0 <span class="sh_symbol">+</span> F3<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span>
    <span class="sh_keyword">for</span><span class="sh_symbol">(</span>i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span> i <span class="sh_symbol">&lt;</span> q<span class="sh_symbol">;</span> i<span class="sh_symbol">++)</span>
        <span class="sh_function">printf</span><span class="sh_symbol">(</span><span class="sh_string">"%lf</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">,</span> ans<span class="sh_symbol">[</span>i<span class="sh_symbol">]);</span>
    <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

</code></pre></div>

<h2>坑</h2>
<p><s>这题 xjb 乱写后一交发现在 lydsy 上居然还有 rank 2？</s></p>
<p>一路跟着思路写下来，还是比较顺的，就有这么点坑：</p>
<p><b>坑1：</b>由于 <i>l<sub>i</sub></i>, <i>w<sub>j</sub></i> ≤ 5 × 10<sup>5</sup>，所以乘起来就爆 <code>int</code> 了，所以乘起来的时候可以转 <code>double</code> (当然转 <code>long long</code> 也是可以滴，不过迟早要转 <code>double</code> 的)。</p>
<p><b>坑2：</b>想对拍的孩纸们，这题的对拍程序写起来还是有一点坑的，可以用以下 datamaker 做参考 <s>(存代码的理由)</s>：</p>
<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_python"><span class="sh_preproc">from</span> random <span class="sh_preproc">import</span> <span class="sh_symbol">*</span>
<span class="sh_preproc">from</span> cyaron <span class="sh_preproc">import</span> <span class="sh_symbol">*</span>

V <span class="sh_symbol">=</span> <span class="sh_number">6</span>
n <span class="sh_symbol">=</span> <span class="sh_number">3</span>
q <span class="sh_symbol">=</span> <span class="sh_number">6</span>
velocity_max <span class="sh_symbol">=</span> <span class="sh_number">500000</span>
<span class="sh_keyword">print</span><span class="sh_symbol">(</span>V<span class="sh_symbol">,</span> n<span class="sh_symbol">,</span> q<span class="sh_symbol">)</span>

<span class="sh_keyword">def</span> <span class="sh_function">wg</span><span class="sh_symbol">():</span>
    <span class="sh_keyword">return</span> <span class="sh_function">randint</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">341468</span><span class="sh_symbol">),</span> <span class="sh_function">randint</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> n<span class="sh_symbol">)</span>

<span class="sh_keyword">def</span> <span class="sh_function">pd</span><span class="sh_symbol">(</span>G<span class="sh_symbol">,</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">):</span>
    <span class="sh_keyword">for</span> e <span class="sh_keyword">in</span> G<span class="sh_symbol">.</span>edges<span class="sh_symbol">[</span>u<span class="sh_symbol">]:</span>
        <span class="sh_keyword">if</span> e<span class="sh_symbol">.</span>end <span class="sh_symbol">==</span> v<span class="sh_symbol">:</span> <span class="sh_keyword">return</span> True
    <span class="sh_keyword">return</span> False

G <span class="sh_symbol">=</span> Graph<span class="sh_symbol">.</span><span class="sh_function">tree</span><span class="sh_symbol">(</span>V<span class="sh_symbol">,</span> weight_gen <span class="sh_symbol">=</span> wg<span class="sh_symbol">)</span>

<span class="sh_comment"># 基环树</span>

u <span class="sh_symbol">=</span> <span class="sh_number">1</span>
v <span class="sh_symbol">=</span> <span class="sh_number">1</span>
<span class="sh_keyword">while</span> u <span class="sh_symbol">==</span> v <span class="sh_keyword">or</span> <span class="sh_function">pd</span><span class="sh_symbol">(</span>G<span class="sh_symbol">,</span> u<span class="sh_symbol">,</span> v<span class="sh_symbol">):</span>
    u<span class="sh_symbol">,</span> v <span class="sh_symbol">=</span> <span class="sh_function">randint</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">),</span> <span class="sh_function">randint</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">)</span>

G<span class="sh_symbol">.</span><span class="sh_function">add_edge</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> weight <span class="sh_symbol">=</span> <span class="sh_function">wg</span><span class="sh_symbol">())</span>

<span class="sh_keyword">for</span> edge <span class="sh_keyword">in</span> G<span class="sh_symbol">.</span><span class="sh_function">iterate_edges</span><span class="sh_symbol">():</span>
    <span class="sh_keyword">print</span><span class="sh_symbol">(</span>edge<span class="sh_symbol">.</span>start<span class="sh_symbol">,</span> edge<span class="sh_symbol">.</span>end<span class="sh_symbol">,</span> edge<span class="sh_symbol">.</span>weight<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> edge<span class="sh_symbol">.</span>weight<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">])</span>

velo_list<span class="sh_symbol">,</span> fee_list <span class="sh_symbol">=</span> <span class="sh_symbol">[],</span> <span class="sh_symbol">[]</span>

<span class="sh_keyword">for</span> i <span class="sh_keyword">in</span> <span class="sh_function">range</span><span class="sh_symbol">(</span>n<span class="sh_symbol">):</span>
    velo_list<span class="sh_symbol">.</span><span class="sh_function">append</span><span class="sh_symbol">(</span><span class="sh_function">randint</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> velocity_max<span class="sh_symbol">))</span>
    fee_list<span class="sh_symbol">.</span><span class="sh_function">append</span><span class="sh_symbol">(</span><span class="sh_function">randint</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">170734</span><span class="sh_symbol">))</span>

velo_list<span class="sh_symbol">.</span><span class="sh_function">sort</span><span class="sh_symbol">(</span>reverse <span class="sh_symbol">=</span> True<span class="sh_symbol">)</span>
fee_list<span class="sh_symbol">.</span><span class="sh_function">sort</span><span class="sh_symbol">(</span>reverse <span class="sh_symbol">=</span> True<span class="sh_symbol">)</span>

<span class="sh_keyword">for</span> i <span class="sh_keyword">in</span> <span class="sh_function">range</span><span class="sh_symbol">(</span>n<span class="sh_symbol">):</span>
    <span class="sh_keyword">print</span><span class="sh_symbol">(</span>velo_list<span class="sh_symbol">[</span>i<span class="sh_symbol">],</span> fee_list<span class="sh_symbol">[</span>i<span class="sh_symbol">])</span>

<span class="sh_keyword">for</span> i <span class="sh_keyword">in</span> <span class="sh_function">range</span><span class="sh_symbol">(</span>q<span class="sh_symbol">):</span>
    u<span class="sh_symbol">,</span> v <span class="sh_symbol">=</span> <span class="sh_function">randint</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">),</span> <span class="sh_function">randint</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> V<span class="sh_symbol">)</span>
    velo <span class="sh_symbol">=</span> <span class="sh_function">randint</span><span class="sh_symbol">(</span><span class="sh_number">20</span><span class="sh_symbol">,</span> velocity_max<span class="sh_symbol">)</span>
    <span class="sh_keyword">print</span><span class="sh_symbol">(</span>u<span class="sh_symbol">,</span> v<span class="sh_symbol">,</span> velo<span class="sh_symbol">)</span>
</code></pre></div>
