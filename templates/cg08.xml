<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/css" href="../additional_files/css/pgmain.min.css"?>
<?xml-stylesheet type="text/css" href="../additional_files/css/sh_typical.min.css"?>

<template>
<title>平面上的圆几何</title>
<pre class="sh_sourceCode"><code class="sh_cpp"><span class="sh_keyword">const</span> <span class="sh_type">double</span> pi <span class="sh_symbol">=</span> M_PI<span class="sh_symbol">,</span> pi2 <span class="sh_symbol">=</span> pi <span class="sh_symbol">*</span> <span class="sh_number">2</span><span class="sh_symbol">.,</span> pi_2 <span class="sh_symbol">=</span> M_PI_2<span class="sh_symbol">;</span>

<span class="sh_keyword">inline</span> <span class="sh_type">double</span> <span class="sh_function">angle</span><span class="sh_symbol">(</span><span class="sh_keyword">const</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span>u<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span>v<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span><span class="sh_keyword">return</span> <span class="sh_function">atan2</span><span class="sh_symbol">(</span>u <span class="sh_symbol">^</span> v<span class="sh_symbol">,</span> u <span class="sh_symbol">*</span> v<span class="sh_symbol">);</span><span class="sh_cbracket">}</span>

<span class="sh_comment">// intersection of circle and line</span>
<span class="sh_type">int</span> <span class="sh_function">intersection</span><span class="sh_symbol">(</span><span class="sh_type">double</span> r2<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span>O<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">line</span><span class="sh_normal"> </span>l<span class="sh_symbol">,</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>ret<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
	<span class="sh_type">double</span> d2 <span class="sh_symbol">=</span> <span class="sh_function">dis2</span><span class="sh_symbol">(</span>O<span class="sh_symbol">,</span> l<span class="sh_symbol">);</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span>j <span class="sh_symbol">=</span> l<span class="sh_symbol">.</span><span class="sh_function">normVec</span><span class="sh_symbol">();</span>
	<span class="sh_keyword">if</span> <span class="sh_symbol">(</span><span class="sh_function">gt</span><span class="sh_symbol">(</span>d2<span class="sh_symbol">,</span> r2<span class="sh_symbol">))</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">vec2</span><span class="sh_symbol">(</span>INFINITY<span class="sh_symbol">,</span> INFINITY<span class="sh_symbol">),</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
	<span class="sh_keyword">if</span> <span class="sh_symbol">(</span><span class="sh_function">ge</span><span class="sh_symbol">(</span>d2<span class="sh_symbol">,</span> r2<span class="sh_symbol">))</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">projection</span><span class="sh_symbol">(</span>O<span class="sh_symbol">,</span> l<span class="sh_symbol">),</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
	<span class="sh_keyword">if</span> <span class="sh_symbol">(</span><span class="sh_function">le</span><span class="sh_symbol">(</span>d2<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">))</span> <span class="sh_cbracket">{</span>
		j <span class="sh_symbol">=</span> j <span class="sh_symbol">*</span> <span class="sh_function">sqrt</span><span class="sh_symbol">(</span>r2 <span class="sh_symbol">/</span> j<span class="sh_symbol">.</span><span class="sh_function">norm2</span><span class="sh_symbol">());</span>
		ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> O <span class="sh_symbol">+</span> j<span class="sh_symbol">.</span><span class="sh_function">trans</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
		ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> O <span class="sh_symbol">+</span> j<span class="sh_symbol">.</span><span class="sh_function">trans</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_symbol">-</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">);</span>
	<span class="sh_cbracket">}</span> <span class="sh_keyword">else</span> <span class="sh_cbracket">{</span>
		<span class="sh_type">double</span> T <span class="sh_symbol">=</span> <span class="sh_function">copysign</span><span class="sh_symbol">(</span><span class="sh_function">sqrt</span><span class="sh_symbol">((</span>r2 <span class="sh_symbol">-</span> d2<span class="sh_symbol">)</span> <span class="sh_symbol">/</span> d2<span class="sh_symbol">),</span> <span class="sh_function">l</span><span class="sh_symbol">(</span>O<span class="sh_symbol">));</span> j <span class="sh_symbol">=</span> j <span class="sh_symbol">*</span> <span class="sh_symbol">(-</span><span class="sh_function">l</span><span class="sh_symbol">(</span>O<span class="sh_symbol">)</span> <span class="sh_symbol">/</span> j<span class="sh_symbol">.</span><span class="sh_function">norm2</span><span class="sh_symbol">());</span>
		ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> O <span class="sh_symbol">+</span> j<span class="sh_symbol">.</span><span class="sh_function">trans</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> T<span class="sh_symbol">,</span> <span class="sh_symbol">-</span>T<span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
		ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> O <span class="sh_symbol">+</span> j<span class="sh_symbol">.</span><span class="sh_function">trans</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_symbol">-</span>T<span class="sh_symbol">,</span> T<span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">);</span>
	<span class="sh_cbracket">}</span>
	<span class="sh_keyword">return</span> <span class="sh_number">2</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_comment">// area of intersection(x^2 + y^2 = r^2, triangle OBC)</span>
<span class="sh_type">double</span> <span class="sh_function">interArea</span><span class="sh_symbol">(</span><span class="sh_type">double</span> r2<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span>B<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span>C<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
	<span class="sh_keyword">if</span> <span class="sh_symbol">(</span><span class="sh_function">eq</span><span class="sh_symbol">(</span>B <span class="sh_symbol">^</span> C<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">))</span> <span class="sh_keyword">return</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
	<span class="sh_usertype">vec2</span><span class="sh_normal"> </span>is<span class="sh_symbol">[</span><span class="sh_number">2</span><span class="sh_symbol">];</span>
	<span class="sh_keyword">if</span> <span class="sh_symbol">(!</span><span class="sh_function">intersection</span><span class="sh_symbol">(</span>r2<span class="sh_symbol">,</span> <span class="sh_function">vec2</span><span class="sh_symbol">(),</span> <span class="sh_function">line</span><span class="sh_symbol">(</span>B<span class="sh_symbol">,</span> C<span class="sh_symbol">),</span> is<span class="sh_symbol">))</span> <span class="sh_keyword">return</span> <span class="sh_number">0.5</span> <span class="sh_symbol">*</span> r2 <span class="sh_symbol">*</span> <span class="sh_function">angle</span><span class="sh_symbol">(</span>B<span class="sh_symbol">,</span> C<span class="sh_symbol">);</span>
	<span class="sh_type">bool</span> b <span class="sh_symbol">=</span> <span class="sh_function">gt</span><span class="sh_symbol">(</span>B<span class="sh_symbol">.</span><span class="sh_function">norm2</span><span class="sh_symbol">(),</span> r2<span class="sh_symbol">),</span> c <span class="sh_symbol">=</span> <span class="sh_function">gt</span><span class="sh_symbol">(</span>C<span class="sh_symbol">.</span><span class="sh_function">norm2</span><span class="sh_symbol">(),</span> r2<span class="sh_symbol">);</span>
	<span class="sh_keyword">if</span> <span class="sh_symbol">(</span>b <span class="sh_symbol">&amp;&amp;</span> c<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_number">0.5</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span><span class="sh_function">lt</span><span class="sh_symbol">(</span><span class="sh_function">dot</span><span class="sh_symbol">(*</span>is<span class="sh_symbol">,</span> B<span class="sh_symbol">,</span> C<span class="sh_symbol">),</span> <span class="sh_number">0</span><span class="sh_symbol">)</span> <span class="sh_symbol">?</span> r2 <span class="sh_symbol">*</span> <span class="sh_symbol">(</span><span class="sh_function">angle</span><span class="sh_symbol">(</span>B<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>is<span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_function">angle</span><span class="sh_symbol">(</span>is<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">],</span> C<span class="sh_symbol">))</span> <span class="sh_symbol">+</span> <span class="sh_symbol">(</span>is<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">^</span> is<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">])</span> <span class="sh_symbol">:</span> r2 <span class="sh_symbol">*</span> <span class="sh_function">angle</span><span class="sh_symbol">(</span>B<span class="sh_symbol">,</span> C<span class="sh_symbol">));</span>
	<span class="sh_keyword">else</span> <span class="sh_keyword">if</span> <span class="sh_symbol">(</span>b<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_number">0.5</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span>r2 <span class="sh_symbol">*</span> <span class="sh_function">angle</span><span class="sh_symbol">(</span>B<span class="sh_symbol">,</span> <span class="sh_symbol">*</span>is<span class="sh_symbol">)</span> <span class="sh_symbol">+</span> <span class="sh_symbol">(*</span>is <span class="sh_symbol">^</span> C<span class="sh_symbol">));</span>
	<span class="sh_keyword">else</span> <span class="sh_keyword">if</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_keyword">return</span> <span class="sh_number">0.5</span> <span class="sh_symbol">*</span> <span class="sh_symbol">((</span>B <span class="sh_symbol">^</span> is<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">])</span> <span class="sh_symbol">+</span> r2 <span class="sh_symbol">*</span> <span class="sh_function">angle</span><span class="sh_symbol">(</span>is<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">],</span> C<span class="sh_symbol">));</span>
	<span class="sh_keyword">else</span> <span class="sh_keyword">return</span> <span class="sh_number">0.5</span> <span class="sh_symbol">*</span> <span class="sh_symbol">(</span>B <span class="sh_symbol">^</span> C<span class="sh_symbol">);</span>
<span class="sh_cbracket">}</span>

<span class="sh_comment">// tangents to circle((0, 0), r) through P</span>
<span class="sh_type">int</span> <span class="sh_function">tangent</span><span class="sh_symbol">(</span><span class="sh_type">double</span> r<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span>P<span class="sh_symbol">,</span> <span class="sh_usertype">line</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>ret<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
	<span class="sh_type">double</span> Q <span class="sh_symbol">=</span> P<span class="sh_symbol">.</span><span class="sh_function">norm2</span><span class="sh_symbol">()</span> <span class="sh_symbol">-</span> r <span class="sh_symbol">*</span> r<span class="sh_symbol">;</span>
	<span class="sh_keyword">if</span> <span class="sh_symbol">(</span><span class="sh_function">lt</span><span class="sh_symbol">(</span>Q<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">))</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">line</span><span class="sh_symbol">(</span>INFINITY<span class="sh_symbol">,</span> INFINITY<span class="sh_symbol">,</span> INFINITY<span class="sh_symbol">),</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
	<span class="sh_keyword">if</span> <span class="sh_symbol">(</span><span class="sh_function">le</span><span class="sh_symbol">(</span>Q<span class="sh_symbol">,</span> <span class="sh_number">0</span><span class="sh_symbol">))</span> <span class="sh_keyword">return</span> ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">line</span><span class="sh_symbol">(</span>P<span class="sh_symbol">.</span>x<span class="sh_symbol">,</span> P<span class="sh_symbol">.</span>y<span class="sh_symbol">,</span> <span class="sh_symbol">-</span>P<span class="sh_symbol">.</span><span class="sh_function">norm2</span><span class="sh_symbol">()),</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
	Q <span class="sh_symbol">=</span> <span class="sh_function">sqrt</span><span class="sh_symbol">(</span>Q<span class="sh_symbol">)</span> <span class="sh_symbol">/</span> r<span class="sh_symbol">;</span>
	ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">line</span><span class="sh_symbol">(</span>P<span class="sh_symbol">.</span>x <span class="sh_symbol">+</span> Q <span class="sh_symbol">*</span> P<span class="sh_symbol">.</span>y<span class="sh_symbol">,</span> P<span class="sh_symbol">.</span>y <span class="sh_symbol">-</span> Q <span class="sh_symbol">*</span> P<span class="sh_symbol">.</span>x<span class="sh_symbol">,</span> <span class="sh_symbol">-</span>P<span class="sh_symbol">.</span><span class="sh_function">norm2</span><span class="sh_symbol">());</span>
	ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_function">line</span><span class="sh_symbol">(</span>P<span class="sh_symbol">.</span>x <span class="sh_symbol">-</span> Q <span class="sh_symbol">*</span> P<span class="sh_symbol">.</span>y<span class="sh_symbol">,</span> P<span class="sh_symbol">.</span>y <span class="sh_symbol">+</span> Q <span class="sh_symbol">*</span> P<span class="sh_symbol">.</span>x<span class="sh_symbol">,</span> <span class="sh_symbol">-</span>P<span class="sh_symbol">.</span><span class="sh_function">norm2</span><span class="sh_symbol">());</span>
	<span class="sh_keyword">return</span> <span class="sh_number">2</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

<span class="sh_comment">// tangets to circle(O, r) through P</span>
<span class="sh_type">int</span> <span class="sh_function">tangent</span><span class="sh_symbol">(</span><span class="sh_type">double</span> r<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span>O<span class="sh_symbol">,</span> <span class="sh_keyword">const</span> <span class="sh_usertype">vec2</span><span class="sh_normal"> </span>P<span class="sh_symbol">,</span> <span class="sh_usertype">line</span><span class="sh_normal"> </span><span class="sh_symbol">*</span>ret<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
	<span class="sh_type">int</span> R <span class="sh_symbol">=</span> <span class="sh_function">tangent</span><span class="sh_symbol">(</span>r<span class="sh_symbol">,</span> P <span class="sh_symbol">-</span> O<span class="sh_symbol">,</span> ret<span class="sh_symbol">);</span>
	<span class="sh_keyword">if</span> <span class="sh_symbol">(</span>R<span class="sh_symbol">)</span>
		ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">].</span>C <span class="sh_symbol">-=</span> ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">].</span>A <span class="sh_symbol">*</span> O<span class="sh_symbol">.</span>x <span class="sh_symbol">+</span> ret<span class="sh_symbol">[</span><span class="sh_number">0</span><span class="sh_symbol">].</span>B <span class="sh_symbol">*</span> O<span class="sh_symbol">.</span>y<span class="sh_symbol">,</span>
		ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">].</span>C <span class="sh_symbol">-=</span> ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">].</span>A <span class="sh_symbol">*</span> O<span class="sh_symbol">.</span>x <span class="sh_symbol">+</span> ret<span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">].</span>B <span class="sh_symbol">*</span> O<span class="sh_symbol">.</span>y<span class="sh_symbol">;</span>
	<span class="sh_keyword">return</span> R<span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span></code></pre>
</template>
